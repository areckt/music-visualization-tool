var Jo=Object.defineProperty;var Zo=(L,O,W)=>O in L?Jo(L,O,{enumerable:!0,configurable:!0,writable:!0,value:W}):L[O]=W;var C=(L,O,W)=>(Zo(L,typeof O!="symbol"?O+"":O,W),W),tr=(L,O,W)=>{if(!O.has(L))throw TypeError("Cannot "+W)};var it=(L,O,W)=>(tr(L,O,"read from private field"),W?W.call(L):O.get(L)),er=(L,O,W)=>{if(O.has(L))throw TypeError("Cannot add the same private member more than once");O instanceof WeakSet?O.add(L):O.set(L,W)},Me=(L,O,W,Bt)=>(tr(L,O,"write to private field"),Bt?Bt.call(L,W):O.set(L,W),W);var rr=(L,O,W)=>(tr(L,O,"access private method"),W);(function(){"use strict";var Lt,nr,Dt,J;var L=Object.freeze({__proto__:null,get default(){return kn}});/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const O=Symbol("Comlink.proxy"),W=Symbol("Comlink.endpoint"),Bt=Symbol("Comlink.releaseProxy"),xe=Symbol("Comlink.finalizer"),Ut=Symbol("Comlink.thrown"),sr=n=>typeof n=="object"&&n!==null||typeof n=="function",mn={canHandle:n=>sr(n)&&n[O],serialize(n){const{port1:t,port2:r}=new MessageChannel;return ve(n,t),[r,[r]]},deserialize(n){return n.start(),yn(n)}},wn={canHandle:n=>sr(n)&&Ut in n,serialize({value:n}){let t;return n instanceof Error?t={isError:!0,value:{message:n.message,name:n.name,stack:n.stack}}:t={isError:!1,value:n},[t,[]]},deserialize(n){throw n.isError?Object.assign(new Error(n.value.message),n.value):n.value}},ir=new Map([["proxy",mn],["throw",wn]]);function pn(n,t){for(const r of n)if(t===r||r==="*"||r instanceof RegExp&&r.test(t))return!0;return!1}function ve(n,t=globalThis,r=["*"]){t.addEventListener("message",function e(s){if(!s||!s.data)return;if(!pn(r,s.origin)){console.warn(`Invalid origin '${s.origin}' for comlink proxy`);return}const{id:i,type:o,path:u}=Object.assign({path:[]},s.data),l=(s.data.argumentList||[]).map(mt);let a;try{const f=u.slice(0,-1).reduce((c,w)=>c[w],n),h=u.reduce((c,w)=>c[w],n);switch(o){case"GET":a=h;break;case"SET":f[u.slice(-1)[0]]=mt(s.data.value),a=!0;break;case"APPLY":a=h.apply(f,l);break;case"CONSTRUCT":{const c=new h(...l);a=Sn(c)}break;case"ENDPOINT":{const{port1:c,port2:w}=new MessageChannel;ve(n,w),a=vn(c,[c])}break;case"RELEASE":a=void 0;break;default:return}}catch(f){a={value:f,[Ut]:0}}Promise.resolve(a).catch(f=>({value:f,[Ut]:0})).then(f=>{const[h,c]=Xt(f);t.postMessage(Object.assign(Object.assign({},h),{id:i}),c),o==="RELEASE"&&(t.removeEventListener("message",e),or(t),xe in n&&typeof n[xe]=="function"&&n[xe]())}).catch(f=>{const[h,c]=Xt({value:new TypeError("Unserializable return value"),[Ut]:0});t.postMessage(Object.assign(Object.assign({},h),{id:i}),c)})}),t.start&&t.start()}function dn(n){return n.constructor.name==="MessagePort"}function or(n){dn(n)&&n.close()}function yn(n,t){return Se(n,[],t)}function Gt(n){if(n)throw new Error("Proxy has been released and is not useable")}function lr(n){return vt(n,{type:"RELEASE"}).then(()=>{or(n)})}const Wt=new WeakMap,_t="FinalizationRegistry"in globalThis&&new FinalizationRegistry(n=>{const t=(Wt.get(n)||0)-1;Wt.set(n,t),t===0&&lr(n)});function bn(n,t){const r=(Wt.get(t)||0)+1;Wt.set(t,r),_t&&_t.register(n,t,n)}function Mn(n){_t&&_t.unregister(n)}function Se(n,t=[],r=function(){}){let e=!1;const s=new Proxy(r,{get(i,o){if(Gt(e),o===Bt)return()=>{Mn(s),lr(n),e=!0};if(o==="then"){if(t.length===0)return{then:()=>s};const u=vt(n,{type:"GET",path:t.map(l=>l.toString())}).then(mt);return u.then.bind(u)}return Se(n,[...t,o])},set(i,o,u){Gt(e);const[l,a]=Xt(u);return vt(n,{type:"SET",path:[...t,o].map(f=>f.toString()),value:l},a).then(mt)},apply(i,o,u){Gt(e);const l=t[t.length-1];if(l===W)return vt(n,{type:"ENDPOINT"}).then(mt);if(l==="bind")return Se(n,t.slice(0,-1));const[a,f]=ur(u);return vt(n,{type:"APPLY",path:t.map(h=>h.toString()),argumentList:a},f).then(mt)},construct(i,o){Gt(e);const[u,l]=ur(o);return vt(n,{type:"CONSTRUCT",path:t.map(a=>a.toString()),argumentList:u},l).then(mt)}});return bn(s,n),s}function xn(n){return Array.prototype.concat.apply([],n)}function ur(n){const t=n.map(Xt);return[t.map(r=>r[0]),xn(t.map(r=>r[1]))]}const ar=new WeakMap;function vn(n,t){return ar.set(n,t),n}function Sn(n){return Object.assign(n,{[O]:!0})}function Xt(n){for(const[t,r]of ir)if(r.canHandle(n)){const[e,s]=r.serialize(n);return[{type:"HANDLER",name:t,value:e},s]}return[{type:"RAW",value:n},ar.get(n)||[]]}function mt(n){switch(n.type){case"HANDLER":return ir.get(n.name).deserialize(n.value);case"RAW":return n.value}}function vt(n,t,r){return new Promise(e=>{const s=En();n.addEventListener("message",function i(o){!o.data||!o.data.id||o.data.id!==s||(n.removeEventListener("message",i),e(o.data))}),n.start&&n.start(),n.postMessage(Object.assign({id:s},t),r)})}function En(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var gt={},Nn=Object.freeze({__proto__:null,default:gt});const Ft=Object.freeze({UINT8:{name:"UINT8",max:Math.pow(2,8)-1,min:0,scale:Math.pow(2,8)-1,array:Uint8Array},UINT16:{name:"UINT16",max:Math.pow(2,16)-1,min:0,scale:Math.pow(2,16)-1,array:Uint16Array},UINT32:{name:"UINT32",max:Math.pow(2,32)-1,min:0,scale:Math.pow(2,32)-1,array:Uint32Array},INT8:{name:"INT8",max:Math.pow(2,7)-1,min:-Math.pow(2,7),scale:Math.pow(2,7)-1,array:Int8Array},INT16:{name:"INT16",max:Math.pow(2,15)-1,min:-Math.pow(2,15),scale:Math.pow(2,15)-1,array:Int16Array},INT32:{name:"INT32",max:Math.pow(2,31)-1,min:-Math.pow(2,31),scale:Math.pow(2,31)-1,array:Int32Array},FLOAT32:{name:"FLOAT32",max:Number.POSITIVE_INFINITY,min:Number.NEGATIVE_INFINITY,scale:1,array:Float32Array},FLOAT64:{name:"FLOAT64",max:Number.POSITIVE_INFINITY,min:Number.NEGATIVE_INFINITY,scale:1,array:Float64Array}});function hr(n){if(typeof n=="string"){for(const t of Object.values(Ft))if(t.name===n)return t}else return n}class K{constructor(t){C(this,"data");C(this,"size");C(this,"featureAmount");C(this,"sampleDuration");C(this,"numberType");C(this,"length");this.size=t.size,this.featureAmount=t.featureAmount||1,this.numberType=hr(t.numberType)||Ft.FLOAT32,this.sampleDuration=t.sampleDuration||1,this.length=(this.size*this.size+this.size)/2*this.featureAmount,t.buffer?(this.data=new this.numberType.array(t.buffer),gt(this.length===this.data.length)):this.data=new this.numberType.array(this.length)}static get NumberType(){return Ft}static from(t,r){if(typeof t===L)return this.fromMatrix(t);r||(r={});const e=r.featureAmount||t.featureAmount,s=r.numberType||t.numberType,i=r.sampleDuration||t.sampleDuration;return new K({size:t.size,featureAmount:e,numberType:s,sampleDuration:i})}static fromMatrix(t){const r=new K({size:t.width,numberType:t.numberType,sampleDuration:t.sampleDuration});return r.fill((e,s)=>t.getValue(e,s)),r}clone(){const t=new K({size:this.size,numberType:this.numberType,sampleDuration:this.sampleDuration});return t.fillByIndex(r=>this.data[r]),t}getCellFromIndex(t){}hasCell(t,r){return t<=r&&r<this.size&&t>=0&&r>=0}setValue(t,r,e){this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount]=e}setValueNormalized(t,r,e){this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount]=e*this.numberType.scale}setValueNormalizedMirrored(t,r,e){t>r?this.data[(t*t+t)/2*this.featureAmount+r*this.featureAmount]=e*this.numberType.scale:this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount]=e*this.numberType.scale}getValue(t,r,e=0){return this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount+e]}getValues(t,r){const e=new this.numberType.array(this.featureAmount);for(let s=0;s<this.featureAmount;s++)e[s]=this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount+s];return e}getValueMirrored(t,r){return t>r?this.data[(t*t+t)/2*this.featureAmount+r*this.featureAmount]:this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount]}getValuesNormalized(t,r){const e=new this.numberType.array(this.featureAmount);for(let s=0;s<this.featureAmount;s++)e[s]=this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount+s]/this.numberType.scale;return e}getValueNormalizedMirrored(t,r){return t>r?this.data[(t*t+t)/2*this.featureAmount+r*this.featureAmount]/this.numberType.scale:this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount]/this.numberType.scale}getValueNormalized(t,r,e=0){return this.data[(r*r+r)/2*this.featureAmount+t*this.featureAmount+e]/this.numberType.scale}getColumnNormalized(t){const r=new Float32Array(this.size);for(let e=0;e<this.size;e++)r[e]=this.getValueNormalizedMirrored(t,e);return r}fillByIndex(t){let r=this.length;for(;r--;)this.data[r]=t(r)}fill(t){for(let r=0;r<this.size;r++){const e=(r*r+r)/2*this.featureAmount;for(let s=0;s<r+1;s++)this.data[e+s*this.featureAmount]=t(s,r)}}fillFeatures(t){for(let r=0;r<this.size;r++){const e=(r*r+r)/2*this.featureAmount;for(let s=0;s<r+1;s++)for(let i=0;i<this.featureAmount;i++)this.data[e+s*this.featureAmount+i]=t(s,r,i)}}fillFeaturesNormalized(t){for(let r=0;r<this.size;r++){const e=(r*r+r)/2*this.featureAmount;for(let s=0;s<r+1;s++)for(let i=0;i<this.featureAmount;i++)this.data[e+s*this.featureAmount+i]=t(s,r,i)*this.numberType.scale}}forEach(t){let r=this.length;for(;r--;)t(this.data[r],r)}forEachCell(t){for(let r=0;r<this.size;r++){const e=(r*r+r)/2*this.featureAmount;for(let s=0;s<r+1;s++)t(s,r,this.data[e+s])}}fillNormalized(t){for(let r=0;r<this.size;r++){const e=(r*r+r)/2;for(let s=0;s<r+1;s++)this.data[e+s]=t(s,r)*this.numberType.scale}}map(t){let r=this.length;for(;r--;)this.data[r]=t(this.data[r])}divide(t){let r=this.length;for(;r--;)this.data[r]/=t}multiply(t){let r=this.length;for(;r--;)this.data[r]*=t}add(t){let r=this.length;for(;r--;)this.data[r]+=t}getFirstFeatureMatrix(){const t=new K(this);return t.fill((r,e)=>this.getValue(r,e)),t}getFeatureMatrix(t){const r=new K(this);return r.fill((e,s)=>this.getValue(e,s,t)),r}getBuffer(){return{type:"HalfMatrix",buffer:this.data.buffer,size:this.size,numberType:this.numberType.name,featureAmount:this.featureAmount,sampleDuration:this.sampleDuration}}getSampleAmount(){return this.size}getSampleDuration(){return this.sampleDuration}getNestedArray(){const t=new Array(this.size);for(let r=0;r<this.size;r++){t[r]=new Array(this.size);for(let e=0;e<this.size;e++)t[r][e]=this.getValueMirrored(e,r)}return t}getNewEmptyMatrix(){return new K(this)}getSize(){return this.size}normalize(){let t=this.numberType.max,r=this.numberType.min;this.forEach(s=>{s>r&&(r=s),s<t&&(t=s)});let e=this.length;for(;e--;)this.data[e]=(this.data[e]-t)/(r-t)}getMeanAndStandardDeviation(){if(this.featureAmount>1)return 0;let t=0;for(let i=0;i<this.size;i++){const o=(i*i+i)/2*this.featureAmount;for(let u=0;u<i+1;u++)t+=this.data[o+u]/this.numberType.scale}const r=t/this.data.length;let e=0;for(let i=0;i<this.size;i++){const o=(i*i+i)/2*this.featureAmount;for(let u=0;u<i+1;u++)e+=Math.pow(this.data[o+u]/this.numberType.scale-r,2)}const s=Math.sqrt(e/this.data.length);return[r,s]}changeDistribution(t,r){const[e,s]=this.getMeanAndStandardDeviation();let i=this.length;for(;i--;){let o=this.data[i]/this.numberType.scale;o-=e,o*=r,o+=e+t,o=Math.min(1,Math.max(0,o)),this.data[i]=o*this.numberType.scale}}}var jn=Object.freeze({__proto__:null,default:K});let kn=class xt{constructor(t){C(this,"data");C(this,"width");C(this,"height");C(this,"featureAmount");C(this,"sampleDuration");C(this,"numberType");C(this,"length");this.width=t.width||t.size,this.height=t.height||t.size,this.featureAmount=t.featureAmount||1,this.numberType=hr(t.numberType)||Ft.FLOAT32,this.sampleDuration=t.sampleDuration||1,this.length=this.width*this.height*this.featureAmount,t.buffer?(this.data=new this.numberType.array(t.buffer),gt(this.length===this.data.length)):this.data=new this.numberType.array(this.length)}static get NumberType(){return Ft}static from(t,r){if(typeof t===jn)return this.fromHalfMatrix(t);r||(r={});const e=r.featureAmount||t.featureAmount,s=r.numberType||t.numberType,i=r.sampleDuration||t.sampleDuration,o=t.width||t.size,u=t.height||t.size;return new xt({width:o,height:u,featureAmount:e,numberType:s,sampleDuration:i})}static fromHalfMatrix(t){const r=new xt({width:t.size,height:t.size,numberType:t.numberType,sampleDuration:t.sampleDuration});return r.fill((e,s)=>t.getValueMirrored(e,s)),r}static createTimeLagMatrix(t){const r=t.size||t.width,e=new xt(t);return e.fill((s,i)=>{const o=(s+i)%r;return t.getValueMirrored(o,s)}),e}static combine(t,r){gt(t.size===r.size),gt(t.numberType===r.numberType),gt(t.sampleDuration===r.sampleDuration);const e=t.size,s=t.numberType,i=t.sampleDuration,o=new xt({width:e,height:e,numberType:s,sampleDuration:i});return o.fill((u,l)=>u>l?r.getValueMirrored(u,l):t.getValue(u,l)),o}clone(){const t=new xt({height:this.height,width:this.width,numberType:this.numberType,sampleDuration:this.sampleDuration});return t.fillByIndex(r=>this.data[r]),t}hasCell(t,r){return t<this.width&&r<this.height&&t>=0&&r>=0}setValue(t,r,e){this.data[(r*this.width+t)*this.featureAmount]=e}getValueMirrored(t,r,e=0){return this.getValue(t,r,e)}getValue(t,r,e=0){return this.data[(r*this.width+t)*this.featureAmount+e]}getValues(t,r){const e=new this.numberType.array(this.featureAmount);for(let s=0;s<this.featureAmount;s++)e[s]=this.data[(r*this.width+t)*this.featureAmount+s];return e}getValuesNormalized(t,r){const e=new this.numberType.array(this.featureAmount);for(let s=0;s<this.featureAmount;s++)e[s]=this.data[(r*this.width+t)*this.featureAmount+s]/this.numberType.scale;return e}getValueNormalizedMirrored(t,r){return this.getValueNormalized(t,r)}getValueNormalized(t,r,e=0){return this.data[(r*this.width+t)*this.featureAmount+e]/this.numberType.scale}getColumnNormalized(t){const r=new Float32Array(this.height);for(let e=0;e<this.height;e++)r[e]=this.data[(e*this.width+t)*this.featureAmount]/this.numberType.scale;return r}fillByIndex(t){let r=this.length;for(;r--;)this.data[r]=t(r)}fill(t){for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)this.data[(r*this.width+e)*this.featureAmount]=t(e,r)}fillFeatures(t){for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)for(let s=0;s<this.featureAmount;s++)this.data[(r*this.width+e)*this.featureAmount+s]=t(e,r,s)}fillFeaturesNormalized(t){for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)for(let s=0;s<this.featureAmount;s++)this.data[(r*this.width+e)*this.featureAmount+s]=t(e,r,s)*this.numberType.scale}forEach(t){let r=this.length;for(;r--;)t(this.data[r],r)}forEachCell(t){for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)t(e,r,this.data[(r*this.width+e)*this.featureAmount])}fillNormalized(t){for(let r=0;r<this.height;r++)for(let e=0;e<this.width;e++)this.data[(r*this.width+e)*this.featureAmount]=t(e,r)*this.numberType.max}map(t){let r=this.length;for(;r--;)this.data[r]=t(this.data[r])}divide(t){let r=this.length;for(;r--;)this.data[r]/=t}multiply(t){let r=this.length;for(;r--;)this.data[r]*=t}add(t){let r=this.length;for(;r--;)this.data[r]+=t}getBuffer(){return{type:"Matrix",buffer:this.data.buffer,width:this.width,height:this.height,numberType:this.numberType.name,featureAmount:this.featureAmount,sampleDuration:this.sampleDuration}}getNewEmptyMatrix(){return new xt(this)}getSize(){return gt(this.width===this.height),this.width}getSampleAmount(){return this.height}getSampleDuration(){return this.sampleDuration}normalize(){let t=this.numberType.max,r=this.numberType.min;this.forEach(s=>{s>r&&(r=s),s<t&&(t=s)});let e=this.length;for(;e--;)this.data[e]=(this.data[e]-t)/(r-t)}subtract(t){}};function Ee(n,t=n/2){const r=new Float32Array(n),e=(n-1)/2;let s=0;for(let i=0;i<n;i++)r[i]=Math.exp(-.5*Math.pow((i-e)/t,2)),s+=r[i];for(let i=0;i<n;i++)r[i]/=s;return r}function fr(n,t){const r=[],e=t*2+1,s=Ee(e,t/2),i=n[0].length;for(let o=0;o<n.length;o++){const u=new Float32Array(i);for(let l=0;l<i;l++){let a=0,f=0;for(let h=-t;h<=t;h++)o+h>=0&&o+h<n.length&&(a+=n[o+h][l]*s[h+t],f+=s[h+t]);u[l]=a/f}r.push(u)}return r}function Tn(n,t){const e=new Float32Array(256),s=[],i=n[0].length;for(let o=0;o<n.length;o++){const u=new Float32Array(i);for(let l=0;l<i;l++){let a=0;for(let c=-t;c<=t;c++)if(o+c>=0&&o+c<n.length){const m=n[o+c][l]*.5+.5;e[Math.floor(m*255)]++,a++}let f=a/2,h=-1;for(let c=0;c<256;c++)f-=e[c],f<0&&h===-1&&(h=c/255),e[c]=0;u[l]=2*(h-.5)}s.push(u)}return s}function In(n,t,r=0){const e=[],s=[],i=t*2+1,o=Ee(i,t/2),u=n[0].length;for(let l=0;l<n.length;l++){const a=new Float32Array(u),f=new Float32Array(u);for(let h=0;h<u;h++){let c=0,w=0,m=0,d=0;for(let M=-t-r;M<=-1-r;M++)l+M>=0&&l+M<n.length&&(c+=n[l+M][h]*o[M+t+r],w+=o[M+t+r]);for(let M=1+r;M<=t+r;M++)l+M>=0&&l+M<n.length&&(m+=n[l+M][h]*o[M+t-r],d+=o[M+t-r]);a[h]=c/w,f[h]=m/d}l<=r?e.push(n[l]):e.push(a),l>=n.length-1-r?s.push(n[l]):s.push(f)}return[e,s]}function Rn(n,t,r="zeroPad"){const e=t*2+1,s=Ee(e,t/2),i=new Float32Array(n.length);for(let o=0;o<n.length;o++){let u=0;for(let l=-t;l<=t;l++)if(o+l>=0&&o+l<n.length)u+=n[o+l]*s[l+t];else switch(r){case"zeroPad":break;case"mirror":o-l>=0&&o-l<n.length&&(u+=n[o-l]*s[l+t]);break}i[o]=u}return i}const Dn=Math.sqrt(12),Fn=Math.sqrt(Math.pow(2,2)*12);function Yt(n,t){for(var r=0,e=0,s=0,i=0;i<n.length;i++)r+=n[i]*t[i],e+=n[i]*n[i],s+=t[i]*t[i];return e=Math.sqrt(e),s=Math.sqrt(s),r/(e*s)}function zn(n,t,r){for(var e=0,s=0,i=0,o=0;o<n.length;o++){let u=(o+r)%12;e+=n[o]*t[u],s+=n[o]*n[o],i+=t[u]*t[u]}return s=Math.sqrt(s),i=Math.sqrt(i),e/(s*i)}function $n(n,t){return Math.sqrt(An(n,t))}function qn(n,t,r){return Math.sqrt(Cn(n,t,r))}function Kt(n,t){return 1-$n(n,t)/Fn}function cr(n,t,r){return 1-qn(n,t,r)/Dn}function An(n,t){let r=0;for(let e=0;e<n.length;e++){const s=n[e]-t[e];r+=s*s}return r}function Cn(n,t,r){let e=0;for(let s=0;s<n.length;s++){let i=(s+r)%12;const o=n[s]-t[i];e+=o*o}return e}function Qt(n,t){const r=n.reduce((u,l)=>u+l)/n.length,e=t.reduce((u,l)=>u+l)/t.length;let s=0;for(let u=0;u<n.length;u++)s+=(n[u]-r)*(t[u]-e);const i=n.reduce((u,l)=>u+Math.pow(l-r,2)),o=t.reduce((u,l)=>u+Math.pow(l-e,2));return s/Math.sqrt(i*o)}function Pn(n){const t=new Float32Array(n.length);Array(n[0].length).fill(0),t[0]=1-Kt(n[0],n[1]);for(let r=1;r<n.length;r++)t[r]=1-Kt(n[r-1],n[r]);return t}function gr(n){const t=[];t.push({sample:0,height:0,confidence:1});const r=Math.max.apply(Math,n),e=[],s=[];for(let i=1;i<n.length-1;i++){const o=n[i];n[i-1]<o&&o>=n[i+1]&&e.push({sample:i,height:o}),n[i-1]>o&&o<=n[i+1]&&s.push({sample:i,height:o})}for(let i=0;i<e.length;i++){const o=e[i],u=i===0?{sample:0,height:0}:s[i-1],l=i>=s.length?{sample:n.length-1,height:0}:s[i];let a;u.height<l.height?a=u:a=l;const h=(o.height-a.height)/r;t.push({sample:o.sample,height:o.height,confidence:h})}return t}var wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Ne(n){if(n.__esModule)return n;var t=n.default;if(typeof t=="function"){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(n).forEach(function(e){var s=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(r,e,s.get?s:{enumerable:!0,get:function(){return n[e]}})}),r}var je={exports:{}};je.exports,function(n){(function(t,r,e){function s(l){var a=this,f=u();a.next=function(){var h=2091639*a.s0+a.c*23283064365386963e-26;return a.s0=a.s1,a.s1=a.s2,a.s2=h-(a.c=h|0)},a.c=1,a.s0=f(" "),a.s1=f(" "),a.s2=f(" "),a.s0-=f(l),a.s0<0&&(a.s0+=1),a.s1-=f(l),a.s1<0&&(a.s1+=1),a.s2-=f(l),a.s2<0&&(a.s2+=1),f=null}function i(l,a){return a.c=l.c,a.s0=l.s0,a.s1=l.s1,a.s2=l.s2,a}function o(l,a){var f=new s(l),h=a&&a.state,c=f.next;return c.int32=function(){return f.next()*4294967296|0},c.double=function(){return c()+(c()*2097152|0)*11102230246251565e-32},c.quick=c,h&&(typeof h=="object"&&i(h,f),c.state=function(){return i(f,{})}),c}function u(){var l=4022871197,a=function(f){f=String(f);for(var h=0;h<f.length;h++){l+=f.charCodeAt(h);var c=.02519603282416938*l;l=c>>>0,c-=l,c*=l,l=c>>>0,c-=l,l+=c*4294967296}return(l>>>0)*23283064365386963e-26};return a}r&&r.exports?r.exports=o:e&&e.amd?e(function(){return o}):this.alea=o})(wt,n,!1)}(je);var On=je.exports,ke={exports:{}};ke.exports,function(n){(function(t,r,e){function s(u){var l=this,a="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var h=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^h^h>>>8},u===(u|0)?l.x=u:a+=u;for(var f=0;f<a.length+64;f++)l.x^=a.charCodeAt(f)|0,l.next()}function i(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l}function o(u,l){var a=new s(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,w=(a.next()>>>0)/4294967296,m=(c+w)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(typeof f=="object"&&i(f,a),h.state=function(){return i(a,{})}),h}r&&r.exports?r.exports=o:e&&e.amd?e(function(){return o}):this.xor128=o})(wt,n,!1)}(ke);var Ln=ke.exports,Te={exports:{}};Te.exports,function(n){(function(t,r,e){function s(u){var l=this,a="";l.next=function(){var h=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(h^h<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,u===(u|0)?l.x=u:a+=u;for(var f=0;f<a.length+64;f++)l.x^=a.charCodeAt(f)|0,f==a.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(u,l){return l.x=u.x,l.y=u.y,l.z=u.z,l.w=u.w,l.v=u.v,l.d=u.d,l}function o(u,l){var a=new s(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,w=(a.next()>>>0)/4294967296,m=(c+w)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(typeof f=="object"&&i(f,a),h.state=function(){return i(a,{})}),h}r&&r.exports?r.exports=o:e&&e.amd?e(function(){return o}):this.xorwow=o})(wt,n,!1)}(Te);var Bn=Te.exports,Ie={exports:{}};Ie.exports,function(n){(function(t,r,e){function s(u){var l=this;l.next=function(){var f=l.x,h=l.i,c,w;return c=f[h],c^=c>>>7,w=c^c<<24,c=f[h+1&7],w^=c^c>>>10,c=f[h+3&7],w^=c^c>>>3,c=f[h+4&7],w^=c^c<<7,c=f[h+7&7],c=c^c<<13,w^=c^c<<9,f[h]=w,l.i=h+1&7,w};function a(f,h){var c,w=[];if(h===(h|0))w[0]=h;else for(h=""+h,c=0;c<h.length;++c)w[c&7]=w[c&7]<<15^h.charCodeAt(c)+w[c+1&7]<<13;for(;w.length<8;)w.push(0);for(c=0;c<8&&w[c]===0;++c);for(c==8?w[7]=-1:w[c],f.x=w,f.i=0,c=256;c>0;--c)f.next()}a(l,u)}function i(u,l){return l.x=u.x.slice(),l.i=u.i,l}function o(u,l){u==null&&(u=+new Date);var a=new s(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,w=(a.next()>>>0)/4294967296,m=(c+w)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(f.x&&i(f,a),h.state=function(){return i(a,{})}),h}r&&r.exports?r.exports=o:e&&e.amd?e(function(){return o}):this.xorshift7=o})(wt,n,!1)}(Ie);var Un=Ie.exports,Re={exports:{}};Re.exports,function(n){(function(t,r,e){function s(u){var l=this;l.next=function(){var f=l.w,h=l.X,c=l.i,w,m;return l.w=f=f+1640531527|0,m=h[c+34&127],w=h[c=c+1&127],m^=m<<13,w^=w<<17,m^=m>>>15,w^=w>>>12,m=h[c]=m^w,l.i=c,m+(f^f>>>16)|0};function a(f,h){var c,w,m,d,M,g=[],b=128;for(h===(h|0)?(w=h,h=null):(h=h+"\0",w=0,b=Math.max(b,h.length)),m=0,d=-32;d<b;++d)h&&(w^=h.charCodeAt((d+32)%h.length)),d===0&&(M=w),w^=w<<10,w^=w>>>15,w^=w<<4,w^=w>>>13,d>=0&&(M=M+1640531527|0,c=g[d&127]^=w+M,m=c==0?m+1:0);for(m>=128&&(g[(h&&h.length||0)&127]=-1),m=127,d=4*128;d>0;--d)w=g[m+34&127],c=g[m=m+1&127],w^=w<<13,c^=c<<17,w^=w>>>15,c^=c>>>12,g[m]=w^c;f.w=M,f.X=g,f.i=m}a(l,u)}function i(u,l){return l.i=u.i,l.w=u.w,l.X=u.X.slice(),l}function o(u,l){u==null&&(u=+new Date);var a=new s(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,w=(a.next()>>>0)/4294967296,m=(c+w)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(f.X&&i(f,a),h.state=function(){return i(a,{})}),h}r&&r.exports?r.exports=o:e&&e.amd?e(function(){return o}):this.xor4096=o})(wt,n,!1)}(Re);var Gn=Re.exports,De={exports:{}};De.exports,function(n){(function(t,r,e){function s(u){var l=this,a="";l.next=function(){var h=l.b,c=l.c,w=l.d,m=l.a;return h=h<<25^h>>>7^c,c=c-w|0,w=w<<24^w>>>8^m,m=m-h|0,l.b=h=h<<20^h>>>12^c,l.c=c=c-w|0,l.d=w<<16^c>>>16^m,l.a=m-h|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,u===Math.floor(u)?(l.a=u/4294967296|0,l.b=u|0):a+=u;for(var f=0;f<a.length+20;f++)l.b^=a.charCodeAt(f)|0,l.next()}function i(u,l){return l.a=u.a,l.b=u.b,l.c=u.c,l.d=u.d,l}function o(u,l){var a=new s(u),f=l&&l.state,h=function(){return(a.next()>>>0)/4294967296};return h.double=function(){do var c=a.next()>>>11,w=(a.next()>>>0)/4294967296,m=(c+w)/(1<<21);while(m===0);return m},h.int32=a.next,h.quick=h,f&&(typeof f=="object"&&i(f,a),h.state=function(){return i(a,{})}),h}r&&r.exports?r.exports=o:e&&e.amd?e(function(){return o}):this.tychei=o})(wt,n,!1)}(De);var Wn=De.exports,mr={exports:{}},_n=Ne(Nn);(function(n){(function(t,r,e){var s=256,i=6,o=52,u="random",l=e.pow(s,i),a=e.pow(2,o),f=a*2,h=s-1,c;function w(N,E,I){var v=[];E=E==!0?{entropy:!0}:E||{};var k=g(M(E.entropy?[N,x(r)]:N??b(),3),v),R=new m(v),p=function(){for(var y=R.g(i),j=l,S=0;y<a;)y=(y+S)*s,j*=s,S=R.g(1);for(;y>=f;)y/=2,j/=2,S>>>=1;return(y+S)/j};return p.int32=function(){return R.g(4)|0},p.quick=function(){return R.g(4)/4294967296},p.double=p,g(x(R.S),r),(E.pass||I||function(y,j,S,F){return F&&(F.S&&d(F,R),y.state=function(){return d(R,{})}),S?(e[u]=y,j):y})(p,k,"global"in E?E.global:this==e,E.state)}function m(N){var E,I=N.length,v=this,k=0,R=v.i=v.j=0,p=v.S=[];for(I||(N=[I++]);k<s;)p[k]=k++;for(k=0;k<s;k++)p[k]=p[R=h&R+N[k%I]+(E=p[k])],p[R]=E;(v.g=function(y){for(var j,S=0,F=v.i,$=v.j,q=v.S;y--;)j=q[F=h&F+1],S=S*s+q[h&(q[F]=q[$=h&$+j])+(q[$]=j)];return v.i=F,v.j=$,S})(s)}function d(N,E){return E.i=N.i,E.j=N.j,E.S=N.S.slice(),E}function M(N,E){var I=[],v=typeof N,k;if(E&&v=="object")for(k in N)try{I.push(M(N[k],E-1))}catch{}return I.length?I:v=="string"?N:N+"\0"}function g(N,E){for(var I=N+"",v,k=0;k<I.length;)E[h&k]=h&(v^=E[h&k]*19)+I.charCodeAt(k++);return x(E)}function b(){try{var N;return c&&(N=c.randomBytes)?N=N(s):(N=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(N)),x(N)}catch{var E=t.navigator,I=E&&E.plugins;return[+new Date,t,I,t.screen,x(r)]}}function x(N){return String.fromCharCode.apply(0,N)}if(g(e.random(),r),n.exports){n.exports=w;try{c=_n}catch{}}else e["seed"+u]=w})(typeof self<"u"?self:wt,[],Math)})(mr);var Xn=mr.exports,Yn=On,Kn=Ln,Qn=Bn,Jn=Un,Zn=Gn,Hn=Wn,pt=Xn;pt.alea=Yn,pt.xor128=Kn,pt.xorwow=Qn,pt.xorshift7=Jn,pt.xor4096=Zn,pt.tychei=Hn;var ts=pt,es=Vn(ts);const rs=2220446049250313e-31;function ns(n){var t,r=rs,e=1e-64/r,s=50,i=0,o=0,u=0,l=0,a=0,f=Fe(n),h=f.length,c=f[0].length;if(h<c)throw"Need more rows than columns";var w=new Array(c),m=new Array(c);for(o=0;o<c;o++)w[o]=m[o]=0;var d=wr([c,c],0);function M(y,j){return y=Math.abs(y),j=Math.abs(j),y>j?y*Math.sqrt(1+j*j/y/y):j==0?y:j*Math.sqrt(1+y*y/j/j)}var g=0,b=0,x=0,N=0,E=0,I=0,v=0;for(o=0;o<c;o++){for(w[o]=b,v=0,a=o+1,u=o;u<h;u++)v+=f[u][o]*f[u][o];if(v<=e)b=0;else for(g=f[o][o],b=Math.sqrt(v),g>=0&&(b=-b),x=g*b-v,f[o][o]=g-b,u=a;u<c;u++){for(v=0,l=o;l<h;l++)v+=f[l][o]*f[l][u];for(g=v/x,l=o;l<h;l++)f[l][u]+=g*f[l][o]}for(m[o]=b,v=0,u=a;u<c;u++)v=v+f[o][u]*f[o][u];if(v<=e)b=0;else{for(g=f[o][o+1],b=Math.sqrt(v),g>=0&&(b=-b),x=g*b-v,f[o][o+1]=g-b,u=a;u<c;u++)w[u]=f[o][u]/x;for(u=a;u<h;u++){for(v=0,l=a;l<c;l++)v+=f[u][l]*f[o][l];for(l=a;l<c;l++)f[u][l]+=v*w[l]}}E=Math.abs(m[o])+Math.abs(w[o]),E>N&&(N=E)}for(o=c-1;o!=-1;o+=-1){if(b!=0){for(x=b*f[o][o+1],u=a;u<c;u++)d[u][o]=f[o][u]/x;for(u=a;u<c;u++){for(v=0,l=a;l<c;l++)v+=f[o][l]*d[l][u];for(l=a;l<c;l++)d[l][u]+=v*d[l][o]}}for(u=a;u<c;u++)d[o][u]=0,d[u][o]=0;d[o][o]=1,b=w[o],a=o}for(o=c-1;o!=-1;o+=-1){for(a=o+1,b=m[o],u=a;u<c;u++)f[o][u]=0;if(b!=0){for(x=f[o][o]*b,u=a;u<c;u++){for(v=0,l=a;l<h;l++)v+=f[l][o]*f[l][u];for(g=v/x,l=o;l<h;l++)f[l][u]+=g*f[l][o]}for(u=o;u<h;u++)f[u][o]=f[u][o]/b}else for(u=o;u<h;u++)f[u][o]=0;f[o][o]+=1}for(r=r*N,l=c-1;l!=-1;l+=-1)for(var k=0;k<s;k++){var R=!1;for(a=l;a!=-1;a+=-1){if(Math.abs(w[a])<=r){R=!0;break}if(Math.abs(m[a-1])<=r)break}if(!R){i=0,v=1;var p=a-1;for(o=a;o<l+1&&(g=v*w[o],w[o]=i*w[o],!(Math.abs(g)<=r));o++)for(b=m[o],x=M(g,b),m[o]=x,i=b/x,v=-g/x,u=0;u<h;u++)E=f[u][p],I=f[u][o],f[u][p]=E*i+I*v,f[u][o]=-E*v+I*i}if(I=m[l],a==l){if(I<0)for(m[l]=-I,u=0;u<c;u++)d[u][l]=-d[u][l];break}if(k>s-1)throw new Error("numeric.js, svd(): no convergence");for(N=m[a],E=m[l-1],b=w[l-1],x=w[l],g=((E-I)*(E+I)+(b-x)*(b+x))/(2*x*E),b=M(g,1),g<0?g=((N-I)*(N+I)+x*(E/(g-b)-x))/N:g=((N-I)*(N+I)+x*(E/(g+b)-x))/N,i=1,v=1,o=a+1;o<l+1;o++){for(b=w[o],E=m[o],x=v*b,b=i*b,I=M(g,x),w[o-1]=I,i=g/I,v=x/I,g=N*i+b*v,b=-N*v+b*i,x=E*v,E=E*i,u=0;u<c;u++)N=d[u][o-1],I=d[u][o],d[u][o-1]=N*i+I*v,d[u][o]=-N*v+I*i;for(I=M(g,x),m[o-1]=I,i=g/I,v=x/I,g=i*b+v*E,N=-v*b+i*E,u=0;u<h;u++)E=f[u][o-1],I=f[u][o],f[u][o-1]=E*i+I*v,f[u][o]=-E*v+I*i}w[a]=0,w[l]=g,m[l]=N}for(o=0;o<m.length;o++)m[o]<r&&(m[o]=0);for(o=0;o<c;o++)for(u=o-1;u>=0;u--)if(m[u]<m[o]){for(i=m[u],m[u]=m[o],m[o]=i,l=0;l<f.length;l++)t=f[l][o],f[l][o]=f[l][u],f[l][u]=t;for(l=0;l<d.length;l++)t=d[l][o],d[l][o]=d[l][u],d[l][u]=t;o=u}return{U:f,S:m,V:d}}function Fe(n,t,r){typeof t>"u"&&(t=0),typeof r>"u"&&(r=zt(n).length);var e,s=Array(n.length);if(t===r-1){for(e in n)Object.getOwnPropertyDescriptor(n,e)&&(s[e]=n[e]);return s}for(e in n)Object.getOwnPropertyDescriptor(n,e)&&(s[e]=Fe(n[e],t+1,r)),s[e]=Fe(n[e],t+1,r);return s}function wr(n,t,r){typeof r>"u"&&(r=0);var e=n[r],s=Array(e),i;if(r===n.length-1){for(i=e-2;i>=0;i-=2)s[i+1]=t,s[i]=t;return i===-1&&(s[0]=t),s}for(i=e-1;i>=0;i--)s[i]=wr(n,t,r+1);return s}function zt(n,t,r){if(typeof t>"u"&&(t=[]),typeof n!="object")return t;typeof r>"u"&&(r=0),r in t||(t[r]=0),n.length>t[r]&&(t[r]=n.length);var e;for(e in n)Object.getOwnPropertyDescriptor(n,e)&&zt(n[e],t,r+1);return t}function pr(n,t){if(typeof t=="number")return t*n;if(t.length)return t[0].length?t.map(r=>r.map(e=>e*n)):n.length&&t.length===n.length?t.map((r,e)=>r*n[e]):t.map(r=>r*n);throw new Error(`Invalid input. A is ${t}, and n is ${n}. A should be a number, array of numbers, or matrix of numbers.`)}function ss(n,t){if(typeof n=="number")return n/t;if(n.length)return n[0].length?n.map(r=>r.map(e=>e/t)):t.length&&n.length===t.length?n.map((r,e)=>r/t[e]):n.map(r=>r/t);throw new Error(`Invalid input. A is ${n}, and n is ${t}. A should be a number, array of numbers, or matrix of numbers.`)}function is(n,t){if(typeof n=="number")return Math.pow(n,t);if(n.length)return n[0].length?n.map(r=>r.map(e=>Math.pow(e,t))):n.map(r=>Math.pow(r,t));throw new Error(`Invalid input. A is ${n}, and n is ${t}. A should be a number, array of numbers, or matrix of numbers.`)}function os(n){if(typeof n=="number")return Math.sqrt(n);if(n.length)return n[0].length?n.map(t=>t.map(r=>Math.sqrt(r))):n.map(t=>Math.sqrt(t));throw new Error(`Invalid input. A is ${n}. A should be a number, array of numbers, or matrix of numbers.`)}function ls(){var n=arguments.length,t,r=arguments[0],e;for(t=1;t!==n;++t)e=arguments[t],typeof r=="object"?typeof e=="object"?r=Jt(r,e,zt(r),0,us):r=Jt(r,e,zt(r),0,as):typeof e=="object"?r=Jt(r,e,zt(e),0,hs):r+=e;return r}function us(n,t){var r=t.length,e,s=Array(r);for(e=r-1;e!==-1;--e)s[e]=n[e]+t[e];return s}function as(n,t){var r=n.length,e,s=Array(r);for(e=r-1;e!==-1;--e)s[e]=n[e]+t;return s}function hs(n,t){var r=t.length,e,s=Array(r);for(e=r-1;e!==-1;--e)s[e]=n+t[e];return s}function Jt(n,t,r,e,s){if(e===r.length-1)return s(n,t);var i,o=r[e],u=Array(o);for(i=o-1;i>=0;--i)u[i]=Jt(typeof n=="object"?n[i]:n,typeof t=="object"?t[i]:t,r,e+1,s);return u}function fs(n){var t,r,e=n.length,s=n[0].length,i=Array(s),o,u,l;for(r=0;r<s;r++)i[r]=Array(e);for(t=e-1;t>=1;t-=2){for(u=n[t],o=n[t-1],r=s-1;r>=1;--r)l=i[r],l[t]=u[r],l[t-1]=o[r],--r,l=i[r],l[t]=u[r],l[t-1]=o[r];r===0&&(l=i[0],l[t]=u[0],l[t-1]=o[0])}if(t===0){for(o=n[0],r=s-1;r>=1;--r)i[r][0]=o[r],--r,i[r][0]=o[r];r===0&&(i[0][0]=o[0])}return i}var z={};const cs=Object.prototype.toString;function $t(n){const t=cs.call(n);return t.endsWith("Array]")&&!t.includes("Big")}var gs=Object.freeze({__proto__:null,isAnyArray:$t}),ms=Ne(gs);function ws(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!$t(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,e=r===void 0?0:r,s=t.toIndex,i=s===void 0?n.length:s;if(e<0||e>=n.length||!Number.isInteger(e))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=e||i>n.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=n[e],u=e+1;u<i;u++)n[u]>o&&(o=n[u]);return o}function ps(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!$t(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var r=t.fromIndex,e=r===void 0?0:r,s=t.toIndex,i=s===void 0?n.length:s;if(e<0||e>=n.length||!Number.isInteger(e))throw new Error("fromIndex must be a positive integer smaller than length");if(i<=e||i>n.length||!Number.isInteger(i))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var o=n[e],u=e+1;u<i;u++)n[u]<o&&(o=n[u]);return o}function ds(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if($t(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(t.output!==void 0){if(!$t(t.output))throw new TypeError("output option must be an array if specified");r=t.output}else r=new Array(n.length);var e=ps(n),s=ws(n);if(e===s)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var i=t.min,o=i===void 0?t.autoMinMax?e:0:i,u=t.max,l=u===void 0?t.autoMinMax?s:1:u;if(o>=l)throw new RangeError("min option must be smaller than max option");for(var a=(l-o)/(s-e),f=0;f<n.length;f++)r[f]=(n[f]-e)*a+o;return r}var ys=Object.freeze({__proto__:null,default:ds}),bs=Ne(ys);Object.defineProperty(z,"__esModule",{value:!0});var Z=ms,dr=bs;const Zt=" ".repeat(2),yr=" ".repeat(4);function Ms(){return br(this)}function br(n,t={}){const{maxRows:r=15,maxColumns:e=10,maxNumSize:s=8,padMinus:i="auto"}=t;return`${n.constructor.name} {
${Zt}[
${yr}${xs(n,r,e,s,i)}
${Zt}]
${Zt}rows: ${n.rows}
${Zt}columns: ${n.columns}
}`}function xs(n,t,r,e,s){const{rows:i,columns:o}=n,u=Math.min(i,t),l=Math.min(o,r),a=[];if(s==="auto"){s=!1;t:for(let f=0;f<u;f++)for(let h=0;h<l;h++)if(n.get(f,h)<0){s=!0;break t}}for(let f=0;f<u;f++){let h=[];for(let c=0;c<l;c++)h.push(vs(n.get(f,c),e,s));a.push(`${h.join(" ")}`)}return l!==o&&(a[a.length-1]+=` ... ${o-r} more columns`),u!==i&&a.push(`... ${i-t} more rows`),a.join(`
${yr}`)}function vs(n,t,r){return(n>=0&&r?` ${Mr(n,t-1)}`:Mr(n,t)).padEnd(t)}function Mr(n,t){let r=n.toString();if(r.length<=t)return r;let e=n.toFixed(t);if(e.length>t&&(e=n.toFixed(Math.max(0,t-(e.length-t)))),e.length<=t&&!e.startsWith("0.000")&&!e.startsWith("-0.000"))return e;let s=n.toExponential(t);return s.length>t&&(s=n.toExponential(Math.max(0,t-(s.length-t)))),s.slice(0)}function Ss(n,t){n.prototype.add=function(e){return typeof e=="number"?this.addS(e):this.addM(e)},n.prototype.addS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)+e);return this},n.prototype.addM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)+e.get(s,i));return this},n.add=function(e,s){return new t(e).add(s)},n.prototype.sub=function(e){return typeof e=="number"?this.subS(e):this.subM(e)},n.prototype.subS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)-e);return this},n.prototype.subM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)-e.get(s,i));return this},n.sub=function(e,s){return new t(e).sub(s)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(e){return typeof e=="number"?this.mulS(e):this.mulM(e)},n.prototype.mulS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)*e);return this},n.prototype.mulM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)*e.get(s,i));return this},n.mul=function(e,s){return new t(e).mul(s)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(e){return typeof e=="number"?this.divS(e):this.divM(e)},n.prototype.divS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)/e);return this},n.prototype.divM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)/e.get(s,i));return this},n.div=function(e,s){return new t(e).div(s)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(e){return typeof e=="number"?this.modS(e):this.modM(e)},n.prototype.modS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)%e);return this},n.prototype.modM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)%e.get(s,i));return this},n.mod=function(e,s){return new t(e).mod(s)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(e){return typeof e=="number"?this.andS(e):this.andM(e)},n.prototype.andS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)&e);return this},n.prototype.andM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)&e.get(s,i));return this},n.and=function(e,s){return new t(e).and(s)},n.prototype.or=function(e){return typeof e=="number"?this.orS(e):this.orM(e)},n.prototype.orS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)|e);return this},n.prototype.orM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)|e.get(s,i));return this},n.or=function(e,s){return new t(e).or(s)},n.prototype.xor=function(e){return typeof e=="number"?this.xorS(e):this.xorM(e)},n.prototype.xorS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)^e);return this},n.prototype.xorM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)^e.get(s,i));return this},n.xor=function(e,s){return new t(e).xor(s)},n.prototype.leftShift=function(e){return typeof e=="number"?this.leftShiftS(e):this.leftShiftM(e)},n.prototype.leftShiftS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)<<e);return this},n.prototype.leftShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)<<e.get(s,i));return this},n.leftShift=function(e,s){return new t(e).leftShift(s)},n.prototype.signPropagatingRightShift=function(e){return typeof e=="number"?this.signPropagatingRightShiftS(e):this.signPropagatingRightShiftM(e)},n.prototype.signPropagatingRightShiftS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>e);return this},n.prototype.signPropagatingRightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>e.get(s,i));return this},n.signPropagatingRightShift=function(e,s){return new t(e).signPropagatingRightShift(s)},n.prototype.rightShift=function(e){return typeof e=="number"?this.rightShiftS(e):this.rightShiftM(e)},n.prototype.rightShiftS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>>e);return this},n.prototype.rightShiftM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,this.get(s,i)>>>e.get(s,i));return this},n.rightShift=function(e,s){return new t(e).rightShift(s)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,~this.get(e,s));return this},n.not=function(e){return new t(e).not()},n.prototype.abs=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.abs(this.get(e,s)));return this},n.abs=function(e){return new t(e).abs()},n.prototype.acos=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.acos(this.get(e,s)));return this},n.acos=function(e){return new t(e).acos()},n.prototype.acosh=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.acosh(this.get(e,s)));return this},n.acosh=function(e){return new t(e).acosh()},n.prototype.asin=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.asin(this.get(e,s)));return this},n.asin=function(e){return new t(e).asin()},n.prototype.asinh=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.asinh(this.get(e,s)));return this},n.asinh=function(e){return new t(e).asinh()},n.prototype.atan=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.atan(this.get(e,s)));return this},n.atan=function(e){return new t(e).atan()},n.prototype.atanh=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.atanh(this.get(e,s)));return this},n.atanh=function(e){return new t(e).atanh()},n.prototype.cbrt=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.cbrt(this.get(e,s)));return this},n.cbrt=function(e){return new t(e).cbrt()},n.prototype.ceil=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.ceil(this.get(e,s)));return this},n.ceil=function(e){return new t(e).ceil()},n.prototype.clz32=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.clz32(this.get(e,s)));return this},n.clz32=function(e){return new t(e).clz32()},n.prototype.cos=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.cos(this.get(e,s)));return this},n.cos=function(e){return new t(e).cos()},n.prototype.cosh=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.cosh(this.get(e,s)));return this},n.cosh=function(e){return new t(e).cosh()},n.prototype.exp=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.exp(this.get(e,s)));return this},n.exp=function(e){return new t(e).exp()},n.prototype.expm1=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.expm1(this.get(e,s)));return this},n.expm1=function(e){return new t(e).expm1()},n.prototype.floor=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.floor(this.get(e,s)));return this},n.floor=function(e){return new t(e).floor()},n.prototype.fround=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.fround(this.get(e,s)));return this},n.fround=function(e){return new t(e).fround()},n.prototype.log=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.log(this.get(e,s)));return this},n.log=function(e){return new t(e).log()},n.prototype.log1p=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.log1p(this.get(e,s)));return this},n.log1p=function(e){return new t(e).log1p()},n.prototype.log10=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.log10(this.get(e,s)));return this},n.log10=function(e){return new t(e).log10()},n.prototype.log2=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.log2(this.get(e,s)));return this},n.log2=function(e){return new t(e).log2()},n.prototype.round=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.round(this.get(e,s)));return this},n.round=function(e){return new t(e).round()},n.prototype.sign=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.sign(this.get(e,s)));return this},n.sign=function(e){return new t(e).sign()},n.prototype.sin=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.sin(this.get(e,s)));return this},n.sin=function(e){return new t(e).sin()},n.prototype.sinh=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.sinh(this.get(e,s)));return this},n.sinh=function(e){return new t(e).sinh()},n.prototype.sqrt=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.sqrt(this.get(e,s)));return this},n.sqrt=function(e){return new t(e).sqrt()},n.prototype.tan=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.tan(this.get(e,s)));return this},n.tan=function(e){return new t(e).tan()},n.prototype.tanh=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.tanh(this.get(e,s)));return this},n.tanh=function(e){return new t(e).tanh()},n.prototype.trunc=function(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.set(e,s,Math.trunc(this.get(e,s)));return this},n.trunc=function(e){return new t(e).trunc()},n.pow=function(e,s){return new t(e).pow(s)},n.prototype.pow=function(e){return typeof e=="number"?this.powS(e):this.powM(e)},n.prototype.powS=function(e){for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,Math.pow(this.get(s,i),e));return this},n.prototype.powM=function(e){if(e=t.checkMatrix(e),this.rows!==e.rows||this.columns!==e.columns)throw new RangeError("Matrices dimensions must be equal");for(let s=0;s<this.rows;s++)for(let i=0;i<this.columns;i++)this.set(s,i,Math.pow(this.get(s,i),e.get(s,i)));return this}}function rt(n,t,r){let e=r?n.rows:n.rows-1;if(t<0||t>e)throw new RangeError("Row index out of range")}function nt(n,t,r){let e=r?n.columns:n.columns-1;if(t<0||t>e)throw new RangeError("Column index out of range")}function St(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return t}function Et(n,t){if(t.to1DArray&&(t=t.to1DArray()),t.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return t}function ze(n,t){if(!Z.isAnyArray(t))throw new TypeError("row indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=n.rows)throw new RangeError("row indices are out of range")}function $e(n,t){if(!Z.isAnyArray(t))throw new TypeError("column indices must be an array");for(let r=0;r<t.length;r++)if(t[r]<0||t[r]>=n.columns)throw new RangeError("column indices are out of range")}function qe(n,t,r,e,s){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(te("startRow",t),te("endRow",r),te("startColumn",e),te("endColumn",s),t>r||e>s||t<0||t>=n.rows||r<0||r>=n.rows||e<0||e>=n.columns||s<0||s>=n.columns)throw new RangeError("Submatrix indices are out of range")}function Ht(n,t=0){let r=[];for(let e=0;e<n;e++)r.push(t);return r}function te(n,t){if(typeof t!="number")throw new TypeError(`${n} must be a number`)}function Nt(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function Es(n){let t=Ht(n.rows);for(let r=0;r<n.rows;++r)for(let e=0;e<n.columns;++e)t[r]+=n.get(r,e);return t}function Ns(n){let t=Ht(n.columns);for(let r=0;r<n.rows;++r)for(let e=0;e<n.columns;++e)t[e]+=n.get(r,e);return t}function js(n){let t=0;for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)t+=n.get(r,e);return t}function ks(n){let t=Ht(n.rows,1);for(let r=0;r<n.rows;++r)for(let e=0;e<n.columns;++e)t[r]*=n.get(r,e);return t}function Ts(n){let t=Ht(n.columns,1);for(let r=0;r<n.rows;++r)for(let e=0;e<n.columns;++e)t[e]*=n.get(r,e);return t}function Is(n){let t=1;for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)t*=n.get(r,e);return t}function Rs(n,t,r){const e=n.rows,s=n.columns,i=[];for(let o=0;o<e;o++){let u=0,l=0,a=0;for(let f=0;f<s;f++)a=n.get(o,f)-r[o],u+=a,l+=a*a;t?i.push((l-u*u/s)/(s-1)):i.push((l-u*u/s)/s)}return i}function Ds(n,t,r){const e=n.rows,s=n.columns,i=[];for(let o=0;o<s;o++){let u=0,l=0,a=0;for(let f=0;f<e;f++)a=n.get(f,o)-r[o],u+=a,l+=a*a;t?i.push((l-u*u/e)/(e-1)):i.push((l-u*u/e)/e)}return i}function Fs(n,t,r){const e=n.rows,s=n.columns,i=e*s;let o=0,u=0,l=0;for(let a=0;a<e;a++)for(let f=0;f<s;f++)l=n.get(a,f)-r,o+=l,u+=l*l;return t?(u-o*o/i)/(i-1):(u-o*o/i)/i}function zs(n,t){for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)n.set(r,e,n.get(r,e)-t[r])}function $s(n,t){for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)n.set(r,e,n.get(r,e)-t[e])}function qs(n,t){for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)n.set(r,e,n.get(r,e)-t)}function As(n){const t=[];for(let r=0;r<n.rows;r++){let e=0;for(let s=0;s<n.columns;s++)e+=Math.pow(n.get(r,s),2)/(n.columns-1);t.push(Math.sqrt(e))}return t}function Cs(n,t){for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)n.set(r,e,n.get(r,e)/t[r])}function Ps(n){const t=[];for(let r=0;r<n.columns;r++){let e=0;for(let s=0;s<n.rows;s++)e+=Math.pow(n.get(s,r),2)/(n.rows-1);t.push(Math.sqrt(e))}return t}function Vs(n,t){for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)n.set(r,e,n.get(r,e)/t[e])}function Os(n){const t=n.size-1;let r=0;for(let e=0;e<n.columns;e++)for(let s=0;s<n.rows;s++)r+=Math.pow(n.get(s,e),2)/t;return Math.sqrt(r)}function Ls(n,t){for(let r=0;r<n.rows;r++)for(let e=0;e<n.columns;e++)n.set(r,e,n.get(r,e)/t)}class D{static from1DArray(t,r,e){if(t*r!==e.length)throw new RangeError("data length does not match given dimensions");let i=new T(t,r);for(let o=0;o<t;o++)for(let u=0;u<r;u++)i.set(o,u,e[o*r+u]);return i}static rowVector(t){let r=new T(1,t.length);for(let e=0;e<t.length;e++)r.set(0,e,t[e]);return r}static columnVector(t){let r=new T(t.length,1);for(let e=0;e<t.length;e++)r.set(e,0,t[e]);return r}static zeros(t,r){return new T(t,r)}static ones(t,r){return new T(t,r).fill(1)}static rand(t,r,e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{random:s=Math.random}=e;let i=new T(t,r);for(let o=0;o<t;o++)for(let u=0;u<r;u++)i.set(o,u,s());return i}static randInt(t,r,e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:s=0,max:i=1e3,random:o=Math.random}=e;if(!Number.isInteger(s))throw new TypeError("min must be an integer");if(!Number.isInteger(i))throw new TypeError("max must be an integer");if(s>=i)throw new RangeError("min must be smaller than max");let u=i-s,l=new T(t,r);for(let a=0;a<t;a++)for(let f=0;f<r;f++){let h=s+Math.round(o()*u);l.set(a,f,h)}return l}static eye(t,r,e){r===void 0&&(r=t),e===void 0&&(e=1);let s=Math.min(t,r),i=this.zeros(t,r);for(let o=0;o<s;o++)i.set(o,o,e);return i}static diag(t,r,e){let s=t.length;r===void 0&&(r=s),e===void 0&&(e=r);let i=Math.min(s,r,e),o=this.zeros(r,e);for(let u=0;u<i;u++)o.set(u,u,t[u]);return o}static min(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let e=t.rows,s=t.columns,i=new T(e,s);for(let o=0;o<e;o++)for(let u=0;u<s;u++)i.set(o,u,Math.min(t.get(o,u),r.get(o,u)));return i}static max(t,r){t=this.checkMatrix(t),r=this.checkMatrix(r);let e=t.rows,s=t.columns,i=new this(e,s);for(let o=0;o<e;o++)for(let u=0;u<s;u++)i.set(o,u,Math.max(t.get(o,u),r.get(o,u)));return i}static checkMatrix(t){return D.isMatrix(t)?t:new T(t)}static isMatrix(t){return t!=null&&t.klass==="Matrix"}get size(){return this.rows*this.columns}apply(t){if(typeof t!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)t.call(this,r,e);return this}to1DArray(){let t=[];for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)t.push(this.get(r,e));return t}to2DArray(){let t=[];for(let r=0;r<this.rows;r++){t.push([]);for(let e=0;e<this.columns;e++)t[r].push(this.get(r,e))}return t}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let r=0;r<=t;r++)if(this.get(t,r)!==this.get(r,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(this.get(t,t)!==0)return!1;return!0}isEchelonForm(){let t=0,r=0,e=-1,s=!0,i=!1;for(;t<this.rows&&s;){for(r=0,i=!1;r<this.columns&&i===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>e?(i=!0,e=r):(s=!1,i=!0);t++}return s}isReducedEchelonForm(){let t=0,r=0,e=-1,s=!0,i=!1;for(;t<this.rows&&s;){for(r=0,i=!1;r<this.columns&&i===!1;)this.get(t,r)===0?r++:this.get(t,r)===1&&r>e?(i=!0,e=r):(s=!1,i=!0);for(let o=r+1;o<this.rows;o++)this.get(t,o)!==0&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),r=0,e=0;for(;r<t.rows&&e<t.columns;){let s=r;for(let i=r;i<t.rows;i++)t.get(i,e)>t.get(s,e)&&(s=i);if(t.get(s,e)===0)e++;else{t.swapRows(r,s);let i=t.get(r,e);for(let o=e;o<t.columns;o++)t.set(r,o,t.get(r,o)/i);for(let o=r+1;o<t.rows;o++){let u=t.get(o,e)/t.get(r,e);t.set(o,e,0);for(let l=e+1;l<t.columns;l++)t.set(o,l,t.get(o,l)-t.get(r,l)*u)}r++,e++}}return t}reducedEchelonForm(){let t=this.echelonForm(),r=t.columns,e=t.rows,s=e-1;for(;s>=0;)if(t.maxRow(s)===0)s--;else{let i=0,o=!1;for(;i<e&&o===!1;)t.get(s,i)===1?o=!0:i++;for(let u=0;u<s;u++){let l=t.get(u,i);for(let a=i;a<r;a++){let f=t.get(u,a)-l*t.get(s,a);t.set(u,a,f)}}s--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:e=1}=t;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(e)||e<=0)throw new TypeError("columns must be a positive integer");let s=new T(this.rows*r,this.columns*e);for(let i=0;i<r;i++)for(let o=0;o<e;o++)s.setSubMatrix(this,this.rows*i,this.columns*o);return s}fill(t){for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,t);return this}neg(){return this.mulS(-1)}getRow(t){rt(this,t);let r=[];for(let e=0;e<this.columns;e++)r.push(this.get(t,e));return r}getRowVector(t){return T.rowVector(this.getRow(t))}setRow(t,r){rt(this,t),r=St(this,r);for(let e=0;e<this.columns;e++)this.set(t,e,r[e]);return this}swapRows(t,r){rt(this,t),rt(this,r);for(let e=0;e<this.columns;e++){let s=this.get(t,e);this.set(t,e,this.get(r,e)),this.set(r,e,s)}return this}getColumn(t){nt(this,t);let r=[];for(let e=0;e<this.rows;e++)r.push(this.get(e,t));return r}getColumnVector(t){return T.columnVector(this.getColumn(t))}setColumn(t,r){nt(this,t),r=Et(this,r);for(let e=0;e<this.rows;e++)this.set(e,t,r[e]);return this}swapColumns(t,r){nt(this,t),nt(this,r);for(let e=0;e<this.rows;e++){let s=this.get(e,t);this.set(e,t,this.get(e,r)),this.set(e,r,s)}return this}addRowVector(t){t=St(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)+t[e]);return this}subRowVector(t){t=St(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)-t[e]);return this}mulRowVector(t){t=St(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t[e]);return this}divRowVector(t){t=St(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)/t[e]);return this}addColumnVector(t){t=Et(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)+t[r]);return this}subColumnVector(t){t=Et(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)-t[r]);return this}mulColumnVector(t){t=Et(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)*t[r]);return this}divColumnVector(t){t=Et(this,t);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)this.set(r,e,this.get(r,e)/t[r]);return this}mulRow(t,r){rt(this,t);for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)*r);return this}mulColumn(t,r){nt(this,t);for(let e=0;e<this.rows;e++)this.set(e,t,this.get(e,t)*r);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)>r[e]&&(r[e]=this.get(e,s));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)>r[s]&&(r[s]=this.get(e,s));return r}case void 0:{let r=this.get(0,0);for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)>r&&(r=this.get(e,s));return r}default:throw new Error(`invalid option: ${t}`)}}maxIndex(){Nt(this);let t=this.get(0,0),r=[0,0];for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)>t&&(t=this.get(e,s),r[0]=e,r[1]=s);return r}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)<r[e]&&(r[e]=this.get(e,s));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)<r[s]&&(r[s]=this.get(e,s));return r}case void 0:{let r=this.get(0,0);for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)<r&&(r=this.get(e,s));return r}default:throw new Error(`invalid option: ${t}`)}}minIndex(){Nt(this);let t=this.get(0,0),r=[0,0];for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)this.get(e,s)<t&&(t=this.get(e,s),r[0]=e,r[1]=s);return r}maxRow(t){if(rt(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let e=1;e<this.columns;e++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxRowIndex(t){rt(this,t),Nt(this);let r=this.get(t,0),e=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>r&&(r=this.get(t,s),e[1]=s);return e}minRow(t){if(rt(this,t),this.isEmpty())return NaN;let r=this.get(t,0);for(let e=1;e<this.columns;e++)this.get(t,e)<r&&(r=this.get(t,e));return r}minRowIndex(t){rt(this,t),Nt(this);let r=this.get(t,0),e=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<r&&(r=this.get(t,s),e[1]=s);return e}maxColumn(t){if(nt(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let e=1;e<this.rows;e++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxColumnIndex(t){nt(this,t),Nt(this);let r=this.get(0,t),e=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>r&&(r=this.get(s,t),e[0]=s);return e}minColumn(t){if(nt(this,t),this.isEmpty())return NaN;let r=this.get(0,t);for(let e=1;e<this.rows;e++)this.get(e,t)<r&&(r=this.get(e,t));return r}minColumnIndex(t){nt(this,t),Nt(this);let r=this.get(0,t),e=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<r&&(r=this.get(s,t),e[0]=s);return e}diag(){let t=Math.min(this.rows,this.columns),r=[];for(let e=0;e<t;e++)r.push(this.get(e,e));return r}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)t+=this.get(r,e),this.set(r,e,t);return this}dot(t){D.isMatrix(t)&&(t=t.to1DArray());let r=this.to1DArray();if(r.length!==t.length)throw new RangeError("vectors do not have the same size");let e=0;for(let s=0;s<r.length;s++)e+=r[s]*t[s];return e}mmul(t){t=T.checkMatrix(t);let r=this.rows,e=this.columns,s=t.columns,i=new T(r,s),o=new Float64Array(e);for(let u=0;u<s;u++){for(let l=0;l<e;l++)o[l]=t.get(l,u);for(let l=0;l<r;l++){let a=0;for(let f=0;f<e;f++)a+=this.get(l,f)*o[f];i.set(l,u,a)}}return i}strassen2x2(t){t=T.checkMatrix(t);let r=new T(2,2);const e=this.get(0,0),s=t.get(0,0),i=this.get(0,1),o=t.get(0,1),u=this.get(1,0),l=t.get(1,0),a=this.get(1,1),f=t.get(1,1),h=(e+a)*(s+f),c=(u+a)*s,w=e*(o-f),m=a*(l-s),d=(e+i)*f,M=(u-e)*(s+o),g=(i-a)*(l+f),b=h+m-d+g,x=w+d,N=c+m,E=h-c+w+M;return r.set(0,0,b),r.set(0,1,x),r.set(1,0,N),r.set(1,1,E),r}strassen3x3(t){t=T.checkMatrix(t);let r=new T(3,3);const e=this.get(0,0),s=this.get(0,1),i=this.get(0,2),o=this.get(1,0),u=this.get(1,1),l=this.get(1,2),a=this.get(2,0),f=this.get(2,1),h=this.get(2,2),c=t.get(0,0),w=t.get(0,1),m=t.get(0,2),d=t.get(1,0),M=t.get(1,1),g=t.get(1,2),b=t.get(2,0),x=t.get(2,1),N=t.get(2,2),E=(e+s+i-o-u-f-h)*M,I=(e-o)*(-w+M),v=u*(-c+w+d-M-g-b+N),k=(-e+o+u)*(c-w+M),R=(o+u)*(-c+w),p=e*c,y=(-e+a+f)*(c-m+g),j=(-e+a)*(m-g),S=(a+f)*(-c+m),F=(e+s+i-u-l-a-f)*g,$=f*(-c+m+d-M-g-b+x),q=(-i+f+h)*(M+b-x),V=(i-h)*(M-x),U=i*b,G=(f+h)*(-b+x),_=(-i+u+l)*(g+b-N),ut=(i-l)*(g-N),ct=(u+l)*(-b+N),A=s*d,Y=l*x,tt=o*m,et=a*w,X=h*N,Bo=p+U+A,Uo=E+k+R+p+q+U+G,Go=p+y+S+F+U+_+ct,Wo=I+v+k+p+U+_+ut,_o=I+k+R+p+Y,Xo=U+_+ut+ct+tt,Yo=p+y+j+$+q+V+U,Ko=q+V+U+G+et,Qo=p+y+j+S+X;return r.set(0,0,Bo),r.set(0,1,Uo),r.set(0,2,Go),r.set(1,0,Wo),r.set(1,1,_o),r.set(1,2,Xo),r.set(2,0,Yo),r.set(2,1,Ko),r.set(2,2,Qo),r}mmulStrassen(t){t=T.checkMatrix(t);let r=this.clone(),e=r.rows,s=r.columns,i=t.rows,o=t.columns;s!==i&&console.warn(`Multiplying ${e} x ${s} and ${i} x ${o} matrix: dimensions do not match.`);function u(h,c,w){let m=h.rows,d=h.columns;if(m===c&&d===w)return h;{let M=D.zeros(c,w);return M=M.setSubMatrix(h,0,0),M}}let l=Math.max(e,i),a=Math.max(s,o);r=u(r,l,a),t=u(t,l,a);function f(h,c,w,m){if(w<=512||m<=512)return h.mmul(c);w%2===1&&m%2===1?(h=u(h,w+1,m+1),c=u(c,w+1,m+1)):w%2===1?(h=u(h,w+1,m),c=u(c,w+1,m)):m%2===1&&(h=u(h,w,m+1),c=u(c,w,m+1));let d=parseInt(h.rows/2,10),M=parseInt(h.columns/2,10),g=h.subMatrix(0,d-1,0,M-1),b=c.subMatrix(0,d-1,0,M-1),x=h.subMatrix(0,d-1,M,h.columns-1),N=c.subMatrix(0,d-1,M,c.columns-1),E=h.subMatrix(d,h.rows-1,0,M-1),I=c.subMatrix(d,c.rows-1,0,M-1),v=h.subMatrix(d,h.rows-1,M,h.columns-1),k=c.subMatrix(d,c.rows-1,M,c.columns-1),R=f(D.add(g,v),D.add(b,k),d,M),p=f(D.add(E,v),b,d,M),y=f(g,D.sub(N,k),d,M),j=f(v,D.sub(I,b),d,M),S=f(D.add(g,x),k,d,M),F=f(D.sub(E,g),D.add(b,N),d,M),$=f(D.sub(x,v),D.add(I,k),d,M),q=D.add(R,j);q.sub(S),q.add($);let V=D.add(y,S),U=D.add(p,j),G=D.sub(R,p);G.add(y),G.add(F);let _=D.zeros(2*q.rows,2*q.columns);return _=_.setSubMatrix(q,0,0),_=_.setSubMatrix(V,q.rows,0),_=_.setSubMatrix(U,0,q.columns),_=_.setSubMatrix(G,q.rows,q.columns),_.subMatrix(0,w-1,0,m-1)}return f(r,t,l,a)}scaleRows(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:e=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(e))throw new TypeError("max must be a number");if(r>=e)throw new RangeError("min must be smaller than max");let s=new T(this.rows,this.columns);for(let i=0;i<this.rows;i++){const o=this.getRow(i);o.length>0&&dr(o,{min:r,max:e,output:o}),s.setRow(i,o)}return s}scaleColumns(t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:r=0,max:e=1}=t;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(e))throw new TypeError("max must be a number");if(r>=e)throw new RangeError("min must be smaller than max");let s=new T(this.rows,this.columns);for(let i=0;i<this.columns;i++){const o=this.getColumn(i);o.length&&dr(o,{min:r,max:e,output:o}),s.setColumn(i,o)}return s}flipRows(){const t=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let e=0;e<t;e++){let s=this.get(r,e),i=this.get(r,this.columns-1-e);this.set(r,e,i),this.set(r,this.columns-1-e,s)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let e=0;e<t;e++){let s=this.get(e,r),i=this.get(this.rows-1-e,r);this.set(e,r,i),this.set(this.rows-1-e,r,s)}return this}kroneckerProduct(t){t=T.checkMatrix(t);let r=this.rows,e=this.columns,s=t.rows,i=t.columns,o=new T(r*s,e*i);for(let u=0;u<r;u++)for(let l=0;l<e;l++)for(let a=0;a<s;a++)for(let f=0;f<i;f++)o.set(s*u+a,i*l+f,this.get(u,l)*t.get(a,f));return o}kroneckerSum(t){if(t=T.checkMatrix(t),!this.isSquare()||!t.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,e=t.rows,s=this.kroneckerProduct(T.eye(e,e)),i=T.eye(r,r).kroneckerProduct(t);return s.add(i)}transpose(){let t=new T(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let e=0;e<this.columns;e++)t.set(e,r,this.get(r,e));return t}sortRows(t=xr){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(t));return this}sortColumns(t=xr){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(t));return this}subMatrix(t,r,e,s){qe(this,t,r,e,s);let i=new T(r-t+1,s-e+1);for(let o=t;o<=r;o++)for(let u=e;u<=s;u++)i.set(o-t,u-e,this.get(o,u));return i}subMatrixRow(t,r,e){if(r===void 0&&(r=0),e===void 0&&(e=this.columns-1),r>e||r<0||r>=this.columns||e<0||e>=this.columns)throw new RangeError("Argument out of range");let s=new T(t.length,e-r+1);for(let i=0;i<t.length;i++)for(let o=r;o<=e;o++){if(t[i]<0||t[i]>=this.rows)throw new RangeError(`Row index out of range: ${t[i]}`);s.set(i,o-r,this.get(t[i],o))}return s}subMatrixColumn(t,r,e){if(r===void 0&&(r=0),e===void 0&&(e=this.rows-1),r>e||r<0||r>=this.rows||e<0||e>=this.rows)throw new RangeError("Argument out of range");let s=new T(e-r+1,t.length);for(let i=0;i<t.length;i++)for(let o=r;o<=e;o++){if(t[i]<0||t[i]>=this.columns)throw new RangeError(`Column index out of range: ${t[i]}`);s.set(o-r,i,this.get(o,t[i]))}return s}setSubMatrix(t,r,e){if(t=T.checkMatrix(t),t.isEmpty())return this;let s=r+t.rows-1,i=e+t.columns-1;qe(this,r,s,e,i);for(let o=0;o<t.rows;o++)for(let u=0;u<t.columns;u++)this.set(r+o,e+u,t.get(o,u));return this}selection(t,r){ze(this,t),$e(this,r);let e=new T(t.length,r.length);for(let s=0;s<t.length;s++){let i=t[s];for(let o=0;o<r.length;o++){let u=r[o];e.set(s,o,this.get(i,u))}}return e}trace(){let t=Math.min(this.rows,this.columns),r=0;for(let e=0;e<t;e++)r+=this.get(e,e);return r}clone(){return this.constructor.copy(this,new T(this.rows,this.columns))}static copy(t,r){for(const[e,s,i]of t.entries())r.set(e,s,i);return r}sum(t){switch(t){case"row":return Es(this);case"column":return Ns(this);case void 0:return js(this);default:throw new Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return ks(this);case"column":return Ts(this);case void 0:return Is(this);default:throw new Error(`invalid option: ${t}`)}}mean(t){const r=this.sum(t);switch(t){case"row":{for(let e=0;e<this.rows;e++)r[e]/=this.columns;return r}case"column":{for(let e=0;e<this.columns;e++)r[e]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${t}`)}}variance(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:e=!0,mean:s=this.mean(t)}=r;if(typeof e!="boolean")throw new TypeError("unbiased must be a boolean");switch(t){case"row":{if(!Z.isAnyArray(s))throw new TypeError("mean must be an array");return Rs(this,e,s)}case"column":{if(!Z.isAnyArray(s))throw new TypeError("mean must be an array");return Ds(this,e,s)}case void 0:{if(typeof s!="number")throw new TypeError("mean must be a number");return Fs(this,e,s)}default:throw new Error(`invalid option: ${t}`)}}standardDeviation(t,r){typeof t=="object"&&(r=t,t=void 0);const e=this.variance(t,r);if(t===void 0)return Math.sqrt(e);for(let s=0;s<e.length;s++)e[s]=Math.sqrt(e[s]);return e}center(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:e=this.mean(t)}=r;switch(t){case"row":{if(!Z.isAnyArray(e))throw new TypeError("center must be an array");return zs(this,e),this}case"column":{if(!Z.isAnyArray(e))throw new TypeError("center must be an array");return $s(this,e),this}case void 0:{if(typeof e!="number")throw new TypeError("center must be a number");return qs(this,e),this}default:throw new Error(`invalid option: ${t}`)}}scale(t,r={}){if(typeof t=="object"&&(r=t,t=void 0),typeof r!="object")throw new TypeError("options must be an object");let e=r.scale;switch(t){case"row":{if(e===void 0)e=As(this);else if(!Z.isAnyArray(e))throw new TypeError("scale must be an array");return Cs(this,e),this}case"column":{if(e===void 0)e=Ps(this);else if(!Z.isAnyArray(e))throw new TypeError("scale must be an array");return Vs(this,e),this}case void 0:{if(e===void 0)e=Os(this);else if(typeof e!="number")throw new TypeError("scale must be a number");return Ls(this,e),this}default:throw new Error(`invalid option: ${t}`)}}toString(t){return br(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)yield[t,r,this.get(t,r)]}*values(){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)yield this.get(t,r)}}D.prototype.klass="Matrix",typeof Symbol<"u"&&(D.prototype[Symbol.for("nodejs.util.inspect.custom")]=Ms);function xr(n,t){return n-t}function Bs(n){return n.every(t=>typeof t=="number")}D.random=D.rand,D.randomInt=D.randInt,D.diagonal=D.diag,D.prototype.diagonal=D.prototype.diag,D.identity=D.eye,D.prototype.negate=D.prototype.neg,D.prototype.tensorProduct=D.prototype.kroneckerProduct;let T=(Dt=class extends D{constructor(r,e){super();er(this,Lt);C(this,"data");if(Dt.isMatrix(r))rr(this,Lt,nr).call(this,r.rows,r.columns),Dt.copy(r,this);else if(Number.isInteger(r)&&r>=0)rr(this,Lt,nr).call(this,r,e);else if(Z.isAnyArray(r)){const s=r;if(r=s.length,e=r?s[0].length:0,typeof e!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<r;i++){if(s[i].length!==e)throw new RangeError("Inconsistent array dimensions");if(!Bs(s[i]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(s[i]))}this.rows=r,this.columns=e}else throw new TypeError("First argument must be a positive number or an array")}set(r,e,s){return this.data[r][e]=s,this}get(r,e){return this.data[r][e]}removeRow(r){return rt(this,r),this.data.splice(r,1),this.rows-=1,this}addRow(r,e){return e===void 0&&(e=r,r=this.rows),rt(this,r,!0),e=Float64Array.from(St(this,e)),this.data.splice(r,0,e),this.rows+=1,this}removeColumn(r){nt(this,r);for(let e=0;e<this.rows;e++){const s=new Float64Array(this.columns-1);for(let i=0;i<r;i++)s[i]=this.data[e][i];for(let i=r+1;i<this.columns;i++)s[i-1]=this.data[e][i];this.data[e]=s}return this.columns-=1,this}addColumn(r,e){typeof e>"u"&&(e=r,r=this.columns),nt(this,r,!0),e=Et(this,e);for(let s=0;s<this.rows;s++){const i=new Float64Array(this.columns+1);let o=0;for(;o<r;o++)i[o]=this.data[s][o];for(i[o++]=e[s];o<this.columns+1;o++)i[o]=this.data[s][o-1];this.data[s]=i}return this.columns+=1,this}},Lt=new WeakSet,nr=function(r,e){if(this.data=[],Number.isInteger(e)&&e>=0)for(let s=0;s<r;s++)this.data.push(new Float64Array(e));else throw new TypeError("nColumns must be a positive integer");this.rows=r,this.columns=e},Dt);Ss(D,T);const be=class be extends D{constructor(r){super();er(this,J,void 0);if(T.isMatrix(r)){if(!r.isSymmetric())throw new TypeError("not symmetric data");Me(this,J,T.copy(r,new T(r.rows,r.rows)))}else if(Number.isInteger(r)&&r>=0)Me(this,J,new T(r,r));else if(Me(this,J,new T(r)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return it(this,J).size}get rows(){return it(this,J).rows}get columns(){return it(this,J).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(r){return T.isMatrix(r)&&r.klassType==="SymmetricMatrix"}static zeros(r){return new this(r)}static ones(r){return new this(r).fill(1)}clone(){const r=new be(this.diagonalSize);for(const[e,s,i]of this.upperRightEntries())r.set(e,s,i);return r}toMatrix(){return new T(this)}get(r,e){return it(this,J).get(r,e)}set(r,e,s){return it(this,J).set(r,e,s),it(this,J).set(e,r,s),this}removeCross(r){return it(this,J).removeRow(r),it(this,J).removeColumn(r),this}addCross(r,e){e===void 0&&(e=r,r=this.diagonalSize);const s=e.slice();return s.splice(r,1),it(this,J).addRow(r,s),it(this,J).addColumn(r,e),this}applyMask(r){if(r.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const e=[];for(const[s,i]of r.entries())i||e.push(s);e.reverse();for(const s of e)this.removeCross(s);return this}toCompact(){const{diagonalSize:r}=this,e=new Array(r*(r+1)/2);for(let s=0,i=0,o=0;o<e.length;o++)e[o]=this.get(i,s),++s>=r&&(s=++i);return e}static fromCompact(r){const e=r.length,s=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(s))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(r)}`);const i=new be(s);for(let o=0,u=0,l=0;l<e;l++)i.set(o,u,r[l]),++o>=s&&(o=++u);return i}*upperRightEntries(){for(let r=0,e=0;r<this.diagonalSize;void 0){const s=this.get(r,e);yield[r,e,s],++e>=this.diagonalSize&&(e=++r)}}*upperRightValues(){for(let r=0,e=0;r<this.diagonalSize;void 0)yield this.get(r,e),++e>=this.diagonalSize&&(e=++r)}};J=new WeakMap;let dt=be;dt.prototype.klassType="SymmetricMatrix";class ee extends dt{static isDistanceMatrix(t){return dt.isSymmetricMatrix(t)&&t.klassSubType==="DistanceMatrix"}constructor(t){if(super(t),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(t,r,e){return t===r&&(e=0),super.set(t,r,e)}addCross(t,r){return r===void 0&&(r=t,t=this.diagonalSize),r=r.slice(),r[t]=0,super.addCross(t,r)}toSymmetricMatrix(){return new dt(this)}clone(){const t=new ee(this.diagonalSize);for(const[r,e,s]of this.upperRightEntries())r!==e&&t.set(r,e,s);return t}toCompact(){const{diagonalSize:t}=this,r=(t-1)*t/2,e=new Array(r);for(let s=1,i=0,o=0;o<e.length;o++)e[o]=this.get(i,s),++s>=t&&(s=++i+1);return e}static fromCompact(t){const r=t.length,e=(Math.sqrt(8*r+1)+1)/2;if(!Number.isInteger(e))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);const s=new this(e);for(let i=1,o=0,u=0;u<r;u++)s.set(i,o,t[u]),++i>=e&&(i=++o+1);return s}}ee.prototype.klassSubType="DistanceMatrix";class at extends D{constructor(t,r,e){super(),this.matrix=t,this.rows=r,this.columns=e}}class Us extends at{constructor(t,r){nt(t,r),super(t,t.rows,1),this.column=r}set(t,r,e){return this.matrix.set(t,this.column,e),this}get(t){return this.matrix.get(t,this.column)}}class Gs extends at{constructor(t,r){$e(t,r),super(t,t.rows,r.length),this.columnIndices=r}set(t,r,e){return this.matrix.set(t,this.columnIndices[r],e),this}get(t,r){return this.matrix.get(t,this.columnIndices[r])}}class Ws extends at{constructor(t){super(t,t.rows,t.columns)}set(t,r,e){return this.matrix.set(t,this.columns-r-1,e),this}get(t,r){return this.matrix.get(t,this.columns-r-1)}}class _s extends at{constructor(t){super(t,t.rows,t.columns)}set(t,r,e){return this.matrix.set(this.rows-t-1,r,e),this}get(t,r){return this.matrix.get(this.rows-t-1,r)}}class Xs extends at{constructor(t,r){rt(t,r),super(t,1,t.columns),this.row=r}set(t,r,e){return this.matrix.set(this.row,r,e),this}get(t,r){return this.matrix.get(this.row,r)}}class Ys extends at{constructor(t,r){ze(t,r),super(t,r.length,t.columns),this.rowIndices=r}set(t,r,e){return this.matrix.set(this.rowIndices[t],r,e),this}get(t,r){return this.matrix.get(this.rowIndices[t],r)}}class re extends at{constructor(t,r,e){ze(t,r),$e(t,e),super(t,r.length,e.length),this.rowIndices=r,this.columnIndices=e}set(t,r,e){return this.matrix.set(this.rowIndices[t],this.columnIndices[r],e),this}get(t,r){return this.matrix.get(this.rowIndices[t],this.columnIndices[r])}}class Ks extends at{constructor(t,r,e,s,i){qe(t,r,e,s,i),super(t,e-r+1,i-s+1),this.startRow=r,this.startColumn=s}set(t,r,e){return this.matrix.set(this.startRow+t,this.startColumn+r,e),this}get(t,r){return this.matrix.get(this.startRow+t,this.startColumn+r)}}class Qs extends at{constructor(t){super(t,t.columns,t.rows)}set(t,r,e){return this.matrix.set(r,t,e),this}get(t,r){return this.matrix.get(r,t)}}class vr extends D{constructor(t,r={}){const{rows:e=1}=r;if(t.length%e!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=e,this.columns=t.length/e,this.data=t}set(t,r,e){let s=this._calculateIndex(t,r);return this.data[s]=e,this}get(t,r){let e=this._calculateIndex(t,r);return this.data[e]}_calculateIndex(t,r){return t*this.columns+r}}class H extends D{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,r,e){return this.data[t][r]=e,this}get(t,r){return this.data[t][r]}}function Js(n,t){if(Z.isAnyArray(n))return n[0]&&Z.isAnyArray(n[0])?new H(n):new vr(n,t);throw new Error("the argument is not an array")}class ne{constructor(t){t=H.checkMatrix(t);let r=t.clone(),e=r.rows,s=r.columns,i=new Float64Array(e),o=1,u,l,a,f,h,c,w,m,d;for(u=0;u<e;u++)i[u]=u;for(m=new Float64Array(e),l=0;l<s;l++){for(u=0;u<e;u++)m[u]=r.get(u,l);for(u=0;u<e;u++){for(d=Math.min(u,l),h=0,a=0;a<d;a++)h+=r.get(u,a)*m[a];m[u]-=h,r.set(u,l,m[u])}for(f=l,u=l+1;u<e;u++)Math.abs(m[u])>Math.abs(m[f])&&(f=u);if(f!==l){for(a=0;a<s;a++)c=r.get(f,a),r.set(f,a,r.get(l,a)),r.set(l,a,c);w=i[f],i[f]=i[l],i[l]=w,o=-o}if(l<e&&r.get(l,l)!==0)for(u=l+1;u<e;u++)r.set(u,l,r.get(u,l)/r.get(l,l))}this.LU=r,this.pivotVector=i,this.pivotSign=o}isSingular(){let t=this.LU,r=t.columns;for(let e=0;e<r;e++)if(t.get(e,e)===0)return!0;return!1}solve(t){t=T.checkMatrix(t);let r=this.LU;if(r.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let s=t.columns,i=t.subMatrixRow(this.pivotVector,0,s-1),o=r.columns,u,l,a;for(a=0;a<o;a++)for(u=a+1;u<o;u++)for(l=0;l<s;l++)i.set(u,l,i.get(u,l)-i.get(a,l)*r.get(u,a));for(a=o-1;a>=0;a--){for(l=0;l<s;l++)i.set(a,l,i.get(a,l)/r.get(a,a));for(u=0;u<a;u++)for(l=0;l<s;l++)i.set(u,l,i.get(u,l)-i.get(a,l)*r.get(u,a))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,e=t.columns;for(let s=0;s<e;s++)r*=t.get(s,s);return r}get lowerTriangularMatrix(){let t=this.LU,r=t.rows,e=t.columns,s=new T(r,e);for(let i=0;i<r;i++)for(let o=0;o<e;o++)i>o?s.set(i,o,t.get(i,o)):i===o?s.set(i,o,1):s.set(i,o,0);return s}get upperTriangularMatrix(){let t=this.LU,r=t.rows,e=t.columns,s=new T(r,e);for(let i=0;i<r;i++)for(let o=0;o<e;o++)i<=o?s.set(i,o,t.get(i,o)):s.set(i,o,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ht(n,t){let r=0;return Math.abs(n)>Math.abs(t)?(r=t/n,Math.abs(n)*Math.sqrt(1+r*r)):t!==0?(r=n/t,Math.abs(t)*Math.sqrt(1+r*r)):0}class Ae{constructor(t){t=H.checkMatrix(t);let r=t.clone(),e=t.rows,s=t.columns,i=new Float64Array(s),o,u,l,a;for(l=0;l<s;l++){let f=0;for(o=l;o<e;o++)f=ht(f,r.get(o,l));if(f!==0){for(r.get(l,l)<0&&(f=-f),o=l;o<e;o++)r.set(o,l,r.get(o,l)/f);for(r.set(l,l,r.get(l,l)+1),u=l+1;u<s;u++){for(a=0,o=l;o<e;o++)a+=r.get(o,l)*r.get(o,u);for(a=-a/r.get(l,l),o=l;o<e;o++)r.set(o,u,r.get(o,u)+a*r.get(o,l))}}i[l]=-f}this.QR=r,this.Rdiag=i}solve(t){t=T.checkMatrix(t);let r=this.QR,e=r.rows;if(t.rows!==e)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let s=t.columns,i=t.clone(),o=r.columns,u,l,a,f;for(a=0;a<o;a++)for(l=0;l<s;l++){for(f=0,u=a;u<e;u++)f+=r.get(u,a)*i.get(u,l);for(f=-f/r.get(a,a),u=a;u<e;u++)i.set(u,l,i.get(u,l)+f*r.get(u,a))}for(a=o-1;a>=0;a--){for(l=0;l<s;l++)i.set(a,l,i.get(a,l)/this.Rdiag[a]);for(u=0;u<a;u++)for(l=0;l<s;l++)i.set(u,l,i.get(u,l)-i.get(a,l)*r.get(u,a))}return i.subMatrix(0,o-1,0,s-1)}isFullRank(){let t=this.QR.columns;for(let r=0;r<t;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let t=this.QR,r=t.columns,e=new T(r,r),s,i;for(s=0;s<r;s++)for(i=0;i<r;i++)s<i?e.set(s,i,t.get(s,i)):s===i?e.set(s,i,this.Rdiag[s]):e.set(s,i,0);return e}get orthogonalMatrix(){let t=this.QR,r=t.rows,e=t.columns,s=new T(r,e),i,o,u,l;for(u=e-1;u>=0;u--){for(i=0;i<r;i++)s.set(i,u,0);for(s.set(u,u,1),o=u;o<e;o++)if(t.get(u,u)!==0){for(l=0,i=u;i<r;i++)l+=t.get(i,u)*s.get(i,o);for(l=-l/t.get(u,u),i=u;i<r;i++)s.set(i,o,s.get(i,o)+l*t.get(i,u))}}return s}}class jt{constructor(t,r={}){if(t=H.checkMatrix(t),t.isEmpty())throw new Error("Matrix must be non-empty");let e=t.rows,s=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:o=!0,autoTranspose:u=!1}=r;let l=!!i,a=!!o,f=!1,h;if(e<s)if(!u)h=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{h=t.transpose(),e=h.rows,s=h.columns,f=!0;let p=l;l=a,a=p}else h=t.clone();let c=Math.min(e,s),w=Math.min(e+1,s),m=new Float64Array(w),d=new T(e,c),M=new T(s,s),g=new Float64Array(s),b=new Float64Array(e),x=new Float64Array(w);for(let p=0;p<w;p++)x[p]=p;let N=Math.min(e-1,s),E=Math.max(0,Math.min(s-2,e)),I=Math.max(N,E);for(let p=0;p<I;p++){if(p<N){m[p]=0;for(let y=p;y<e;y++)m[p]=ht(m[p],h.get(y,p));if(m[p]!==0){h.get(p,p)<0&&(m[p]=-m[p]);for(let y=p;y<e;y++)h.set(y,p,h.get(y,p)/m[p]);h.set(p,p,h.get(p,p)+1)}m[p]=-m[p]}for(let y=p+1;y<s;y++){if(p<N&&m[p]!==0){let j=0;for(let S=p;S<e;S++)j+=h.get(S,p)*h.get(S,y);j=-j/h.get(p,p);for(let S=p;S<e;S++)h.set(S,y,h.get(S,y)+j*h.get(S,p))}g[y]=h.get(p,y)}if(l&&p<N)for(let y=p;y<e;y++)d.set(y,p,h.get(y,p));if(p<E){g[p]=0;for(let y=p+1;y<s;y++)g[p]=ht(g[p],g[y]);if(g[p]!==0){g[p+1]<0&&(g[p]=0-g[p]);for(let y=p+1;y<s;y++)g[y]/=g[p];g[p+1]+=1}if(g[p]=-g[p],p+1<e&&g[p]!==0){for(let y=p+1;y<e;y++)b[y]=0;for(let y=p+1;y<e;y++)for(let j=p+1;j<s;j++)b[y]+=g[j]*h.get(y,j);for(let y=p+1;y<s;y++){let j=-g[y]/g[p+1];for(let S=p+1;S<e;S++)h.set(S,y,h.get(S,y)+j*b[S])}}if(a)for(let y=p+1;y<s;y++)M.set(y,p,g[y])}}let v=Math.min(s,e+1);if(N<s&&(m[N]=h.get(N,N)),e<v&&(m[v-1]=0),E+1<v&&(g[E]=h.get(E,v-1)),g[v-1]=0,l){for(let p=N;p<c;p++){for(let y=0;y<e;y++)d.set(y,p,0);d.set(p,p,1)}for(let p=N-1;p>=0;p--)if(m[p]!==0){for(let y=p+1;y<c;y++){let j=0;for(let S=p;S<e;S++)j+=d.get(S,p)*d.get(S,y);j=-j/d.get(p,p);for(let S=p;S<e;S++)d.set(S,y,d.get(S,y)+j*d.get(S,p))}for(let y=p;y<e;y++)d.set(y,p,-d.get(y,p));d.set(p,p,1+d.get(p,p));for(let y=0;y<p-1;y++)d.set(y,p,0)}else{for(let y=0;y<e;y++)d.set(y,p,0);d.set(p,p,1)}}if(a)for(let p=s-1;p>=0;p--){if(p<E&&g[p]!==0)for(let y=p+1;y<s;y++){let j=0;for(let S=p+1;S<s;S++)j+=M.get(S,p)*M.get(S,y);j=-j/M.get(p+1,p);for(let S=p+1;S<s;S++)M.set(S,y,M.get(S,y)+j*M.get(S,p))}for(let y=0;y<s;y++)M.set(y,p,0);M.set(p,p,1)}let k=v-1,R=Number.EPSILON;for(;v>0;){let p,y;for(p=v-2;p>=-1&&p!==-1;p--){const j=Number.MIN_VALUE+R*Math.abs(m[p]+Math.abs(m[p+1]));if(Math.abs(g[p])<=j||Number.isNaN(g[p])){g[p]=0;break}}if(p===v-2)y=4;else{let j;for(j=v-1;j>=p&&j!==p;j--){let S=(j!==v?Math.abs(g[j]):0)+(j!==p+1?Math.abs(g[j-1]):0);if(Math.abs(m[j])<=R*S){m[j]=0;break}}j===p?y=3:j===v-1?y=1:(y=2,p=j)}switch(p++,y){case 1:{let j=g[v-2];g[v-2]=0;for(let S=v-2;S>=p;S--){let F=ht(m[S],j),$=m[S]/F,q=j/F;if(m[S]=F,S!==p&&(j=-q*g[S-1],g[S-1]=$*g[S-1]),a)for(let V=0;V<s;V++)F=$*M.get(V,S)+q*M.get(V,v-1),M.set(V,v-1,-q*M.get(V,S)+$*M.get(V,v-1)),M.set(V,S,F)}break}case 2:{let j=g[p-1];g[p-1]=0;for(let S=p;S<v;S++){let F=ht(m[S],j),$=m[S]/F,q=j/F;if(m[S]=F,j=-q*g[S],g[S]=$*g[S],l)for(let V=0;V<e;V++)F=$*d.get(V,S)+q*d.get(V,p-1),d.set(V,p-1,-q*d.get(V,S)+$*d.get(V,p-1)),d.set(V,S,F)}break}case 3:{const j=Math.max(Math.abs(m[v-1]),Math.abs(m[v-2]),Math.abs(g[v-2]),Math.abs(m[p]),Math.abs(g[p])),S=m[v-1]/j,F=m[v-2]/j,$=g[v-2]/j,q=m[p]/j,V=g[p]/j,U=((F+S)*(F-S)+$*$)/2,G=S*$*(S*$);let _=0;(U!==0||G!==0)&&(U<0?_=0-Math.sqrt(U*U+G):_=Math.sqrt(U*U+G),_=G/(U+_));let ut=(q+S)*(q-S)+_,ct=q*V;for(let A=p;A<v-1;A++){let Y=ht(ut,ct);Y===0&&(Y=Number.MIN_VALUE);let tt=ut/Y,et=ct/Y;if(A!==p&&(g[A-1]=Y),ut=tt*m[A]+et*g[A],g[A]=tt*g[A]-et*m[A],ct=et*m[A+1],m[A+1]=tt*m[A+1],a)for(let X=0;X<s;X++)Y=tt*M.get(X,A)+et*M.get(X,A+1),M.set(X,A+1,-et*M.get(X,A)+tt*M.get(X,A+1)),M.set(X,A,Y);if(Y=ht(ut,ct),Y===0&&(Y=Number.MIN_VALUE),tt=ut/Y,et=ct/Y,m[A]=Y,ut=tt*g[A]+et*m[A+1],m[A+1]=-et*g[A]+tt*m[A+1],ct=et*g[A+1],g[A+1]=tt*g[A+1],l&&A<e-1)for(let X=0;X<e;X++)Y=tt*d.get(X,A)+et*d.get(X,A+1),d.set(X,A+1,-et*d.get(X,A)+tt*d.get(X,A+1)),d.set(X,A,Y)}g[v-2]=ut;break}case 4:{if(m[p]<=0&&(m[p]=m[p]<0?-m[p]:0,a))for(let j=0;j<=k;j++)M.set(j,p,-M.get(j,p));for(;p<k&&!(m[p]>=m[p+1]);){let j=m[p];if(m[p]=m[p+1],m[p+1]=j,a&&p<s-1)for(let S=0;S<s;S++)j=M.get(S,p+1),M.set(S,p+1,M.get(S,p)),M.set(S,p,j);if(l&&p<e-1)for(let S=0;S<e;S++)j=d.get(S,p+1),d.set(S,p+1,d.get(S,p)),d.set(S,p,j);p++}v--;break}}}if(f){let p=M;M=d,d=p}this.m=e,this.n=s,this.s=m,this.U=d,this.V=M}solve(t){let r=t,e=this.threshold,s=this.s.length,i=T.zeros(s,s);for(let c=0;c<s;c++)Math.abs(this.s[c])<=e?i.set(c,c,0):i.set(c,c,1/this.s[c]);let o=this.U,u=this.rightSingularVectors,l=u.mmul(i),a=u.rows,f=o.rows,h=T.zeros(a,f);for(let c=0;c<a;c++)for(let w=0;w<f;w++){let m=0;for(let d=0;d<s;d++)m+=l.get(c,d)*o.get(w,d);h.set(c,w,m)}return h.mmul(r)}solveForDiagonal(t){return this.solve(T.diag(t))}inverse(){let t=this.V,r=this.threshold,e=t.rows,s=t.columns,i=new T(e,this.s.length);for(let f=0;f<e;f++)for(let h=0;h<s;h++)Math.abs(this.s[h])>r&&i.set(f,h,t.get(f,h)/this.s[h]);let o=this.U,u=o.rows,l=o.columns,a=new T(e,u);for(let f=0;f<e;f++)for(let h=0;h<u;h++){let c=0;for(let w=0;w<l;w++)c+=i.get(f,w)*o.get(h,w);a.set(f,h,c)}return a}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,e=this.s;for(let s=0,i=e.length;s<i;s++)e[s]>t&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return T.diag(this.s)}}function Zs(n,t=!1){return n=H.checkMatrix(n),t?new jt(n).inverse():Sr(n,T.eye(n.rows))}function Sr(n,t,r=!1){return n=H.checkMatrix(n),t=H.checkMatrix(t),r?new jt(n).solve(t):n.isSquare()?new ne(n).solve(t):new Ae(n).solve(t)}function se(n){if(n=T.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let t,r,e,s;if(n.columns===2)return t=n.get(0,0),r=n.get(0,1),e=n.get(1,0),s=n.get(1,1),t*s-r*e;if(n.columns===3){let i,o,u;return i=new re(n,[1,2],[1,2]),o=new re(n,[1,2],[0,2]),u=new re(n,[1,2],[0,1]),t=n.get(0,0),r=n.get(0,1),e=n.get(0,2),t*se(i)-r*se(o)+e*se(u)}else return new ne(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function Hs(n,t){let r=[];for(let e=0;e<n;e++)e!==t&&r.push(e);return r}function ti(n,t,r,e=1e-9,s=1e-9){if(n>s)return new Array(t.rows+1).fill(0);{let i=t.addRow(r,[0]);for(let o=0;o<i.rows;o++)Math.abs(i.get(o,0))<e&&i.set(o,0,0);return i.to1DArray()}}function ei(n,t={}){const{thresholdValue:r=1e-9,thresholdError:e=1e-9}=t;n=T.checkMatrix(n);let s=n.rows,i=new T(s,s);for(let o=0;o<s;o++){let u=T.columnVector(n.getRow(o)),l=n.subMatrixRow(Hs(s,o)).transpose(),f=new jt(l).solve(u),h=T.sub(u,l.mmul(f)).abs().max();i.setRow(o,ti(h,f,o,r,e))}return i}function ri(n,t=Number.EPSILON){if(n=T.checkMatrix(n),n.isEmpty())return n.transpose();let r=new jt(n,{autoTranspose:!0}),e=r.leftSingularVectors,s=r.rightSingularVectors,i=r.diagonal;for(let o=0;o<i.length;o++)Math.abs(i[o])>t?i[o]=1/i[o]:i[o]=0;return s.mmul(T.diag(i).mmul(e.transpose()))}function ni(n,t=n,r={}){n=new T(n);let e=!1;if(typeof t=="object"&&!T.isMatrix(t)&&!Z.isAnyArray(t)?(r=t,t=n,e=!0):t=new T(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0}=r;s&&(n=n.center("column"),e||(t=t.center("column")));const i=n.transpose().mmul(t);for(let o=0;o<i.rows;o++)for(let u=0;u<i.columns;u++)i.set(o,u,i.get(o,u)*(1/(n.rows-1)));return i}function si(n,t=n,r={}){n=new T(n);let e=!1;if(typeof t=="object"&&!T.isMatrix(t)&&!Z.isAnyArray(t)?(r=t,t=n,e=!0):t=new T(t),n.rows!==t.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:s=!0,scale:i=!0}=r;s&&(n.center("column"),e||t.center("column")),i&&(n.scale("column"),e||t.scale("column"));const o=n.standardDeviation("column",{unbiased:!0}),u=e?o:t.standardDeviation("column",{unbiased:!0}),l=n.transpose().mmul(t);for(let a=0;a<l.rows;a++)for(let f=0;f<l.columns;f++)l.set(a,f,l.get(a,f)*(1/(o[a]*u[f]))*(1/(n.rows-1)));return l}class Er{constructor(t,r={}){const{assumeSymmetric:e=!1}=r;if(t=H.checkMatrix(t),!t.isSquare())throw new Error("Matrix is not a square matrix");if(t.isEmpty())throw new Error("Matrix must be non-empty");let s=t.columns,i=new T(s,s),o=new Float64Array(s),u=new Float64Array(s),l=t,a,f,h=!1;if(e?h=!0:h=t.isSymmetric(),h){for(a=0;a<s;a++)for(f=0;f<s;f++)i.set(a,f,l.get(a,f));ii(s,u,o,i),oi(s,u,o,i)}else{let c=new T(s,s),w=new Float64Array(s);for(f=0;f<s;f++)for(a=0;a<s;a++)c.set(a,f,l.get(a,f));li(s,c,w,i),ui(s,u,o,i,c)}this.n=s,this.e=u,this.d=o,this.V=i}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t=this.n,r=this.e,e=this.d,s=new T(t,t),i,o;for(i=0;i<t;i++){for(o=0;o<t;o++)s.set(i,o,0);s.set(i,i,e[i]),r[i]>0?s.set(i,i+1,r[i]):r[i]<0&&s.set(i,i-1,r[i])}return s}}function ii(n,t,r,e){let s,i,o,u,l,a,f,h;for(l=0;l<n;l++)r[l]=e.get(n-1,l);for(u=n-1;u>0;u--){for(h=0,o=0,a=0;a<u;a++)h=h+Math.abs(r[a]);if(h===0)for(t[u]=r[u-1],l=0;l<u;l++)r[l]=e.get(u-1,l),e.set(u,l,0),e.set(l,u,0);else{for(a=0;a<u;a++)r[a]/=h,o+=r[a]*r[a];for(s=r[u-1],i=Math.sqrt(o),s>0&&(i=-i),t[u]=h*i,o=o-s*i,r[u-1]=s-i,l=0;l<u;l++)t[l]=0;for(l=0;l<u;l++){for(s=r[l],e.set(l,u,s),i=t[l]+e.get(l,l)*s,a=l+1;a<=u-1;a++)i+=e.get(a,l)*r[a],t[a]+=e.get(a,l)*s;t[l]=i}for(s=0,l=0;l<u;l++)t[l]/=o,s+=t[l]*r[l];for(f=s/(o+o),l=0;l<u;l++)t[l]-=f*r[l];for(l=0;l<u;l++){for(s=r[l],i=t[l],a=l;a<=u-1;a++)e.set(a,l,e.get(a,l)-(s*t[a]+i*r[a]));r[l]=e.get(u-1,l),e.set(u,l,0)}}r[u]=o}for(u=0;u<n-1;u++){if(e.set(n-1,u,e.get(u,u)),e.set(u,u,1),o=r[u+1],o!==0){for(a=0;a<=u;a++)r[a]=e.get(a,u+1)/o;for(l=0;l<=u;l++){for(i=0,a=0;a<=u;a++)i+=e.get(a,u+1)*e.get(a,l);for(a=0;a<=u;a++)e.set(a,l,e.get(a,l)-i*r[a])}}for(a=0;a<=u;a++)e.set(a,u+1,0)}for(l=0;l<n;l++)r[l]=e.get(n-1,l),e.set(n-1,l,0);e.set(n-1,n-1,1),t[0]=0}function oi(n,t,r,e){let s,i,o,u,l,a,f,h,c,w,m,d,M,g,b,x;for(o=1;o<n;o++)t[o-1]=t[o];t[n-1]=0;let N=0,E=0,I=Number.EPSILON;for(a=0;a<n;a++){for(E=Math.max(E,Math.abs(r[a])+Math.abs(t[a])),f=a;f<n&&!(Math.abs(t[f])<=I*E);)f++;if(f>a)do{for(s=r[a],h=(r[a+1]-s)/(2*t[a]),c=ht(h,1),h<0&&(c=-c),r[a]=t[a]/(h+c),r[a+1]=t[a]*(h+c),w=r[a+1],i=s-r[a],o=a+2;o<n;o++)r[o]-=i;for(N=N+i,h=r[f],m=1,d=m,M=m,g=t[a+1],b=0,x=0,o=f-1;o>=a;o--)for(M=d,d=m,x=b,s=m*t[o],i=m*h,c=ht(h,t[o]),t[o+1]=b*c,b=t[o]/c,m=h/c,h=m*r[o]-b*s,r[o+1]=i+b*(m*s+b*r[o]),l=0;l<n;l++)i=e.get(l,o+1),e.set(l,o+1,b*e.get(l,o)+m*i),e.set(l,o,m*e.get(l,o)-b*i);h=-b*x*M*g*t[a]/w,t[a]=b*h,r[a]=m*h}while(Math.abs(t[a])>I*E);r[a]=r[a]+N,t[a]=0}for(o=0;o<n-1;o++){for(l=o,h=r[o],u=o+1;u<n;u++)r[u]<h&&(l=u,h=r[u]);if(l!==o)for(r[l]=r[o],r[o]=h,u=0;u<n;u++)h=e.get(u,o),e.set(u,o,e.get(u,l)),e.set(u,l,h)}}function li(n,t,r,e){let s=0,i=n-1,o,u,l,a,f,h,c;for(h=s+1;h<=i-1;h++){for(c=0,a=h;a<=i;a++)c=c+Math.abs(t.get(a,h-1));if(c!==0){for(l=0,a=i;a>=h;a--)r[a]=t.get(a,h-1)/c,l+=r[a]*r[a];for(u=Math.sqrt(l),r[h]>0&&(u=-u),l=l-r[h]*u,r[h]=r[h]-u,f=h;f<n;f++){for(o=0,a=i;a>=h;a--)o+=r[a]*t.get(a,f);for(o=o/l,a=h;a<=i;a++)t.set(a,f,t.get(a,f)-o*r[a])}for(a=0;a<=i;a++){for(o=0,f=i;f>=h;f--)o+=r[f]*t.get(a,f);for(o=o/l,f=h;f<=i;f++)t.set(a,f,t.get(a,f)-o*r[f])}r[h]=c*r[h],t.set(h,h-1,c*u)}}for(a=0;a<n;a++)for(f=0;f<n;f++)e.set(a,f,a===f?1:0);for(h=i-1;h>=s+1;h--)if(t.get(h,h-1)!==0){for(a=h+1;a<=i;a++)r[a]=t.get(a,h-1);for(f=h;f<=i;f++){for(u=0,a=h;a<=i;a++)u+=r[a]*e.get(a,f);for(u=u/r[h]/t.get(h,h-1),a=h;a<=i;a++)e.set(a,f,e.get(a,f)+u*r[a])}}}function ui(n,t,r,e,s){let i=n-1,o=0,u=n-1,l=Number.EPSILON,a=0,f=0,h=0,c=0,w=0,m=0,d=0,M=0,g,b,x,N,E,I,v,k,R,p,y,j,S,F,$;for(g=0;g<n;g++)for((g<o||g>u)&&(r[g]=s.get(g,g),t[g]=0),b=Math.max(g-1,0);b<n;b++)f=f+Math.abs(s.get(g,b));for(;i>=o;){for(N=i;N>o&&(m=Math.abs(s.get(N-1,N-1))+Math.abs(s.get(N,N)),m===0&&(m=f),!(Math.abs(s.get(N,N-1))<l*m));)N--;if(N===i)s.set(i,i,s.get(i,i)+a),r[i]=s.get(i,i),t[i]=0,i--,M=0;else if(N===i-1){if(v=s.get(i,i-1)*s.get(i-1,i),h=(s.get(i-1,i-1)-s.get(i,i))/2,c=h*h+v,d=Math.sqrt(Math.abs(c)),s.set(i,i,s.get(i,i)+a),s.set(i-1,i-1,s.get(i-1,i-1)+a),k=s.get(i,i),c>=0){for(d=h>=0?h+d:h-d,r[i-1]=k+d,r[i]=r[i-1],d!==0&&(r[i]=k-v/d),t[i-1]=0,t[i]=0,k=s.get(i,i-1),m=Math.abs(k)+Math.abs(d),h=k/m,c=d/m,w=Math.sqrt(h*h+c*c),h=h/w,c=c/w,b=i-1;b<n;b++)d=s.get(i-1,b),s.set(i-1,b,c*d+h*s.get(i,b)),s.set(i,b,c*s.get(i,b)-h*d);for(g=0;g<=i;g++)d=s.get(g,i-1),s.set(g,i-1,c*d+h*s.get(g,i)),s.set(g,i,c*s.get(g,i)-h*d);for(g=o;g<=u;g++)d=e.get(g,i-1),e.set(g,i-1,c*d+h*e.get(g,i)),e.set(g,i,c*e.get(g,i)-h*d)}else r[i-1]=k+h,r[i]=k+h,t[i-1]=d,t[i]=-d;i=i-2,M=0}else{if(k=s.get(i,i),R=0,v=0,N<i&&(R=s.get(i-1,i-1),v=s.get(i,i-1)*s.get(i-1,i)),M===10){for(a+=k,g=o;g<=i;g++)s.set(g,g,s.get(g,g)-k);m=Math.abs(s.get(i,i-1))+Math.abs(s.get(i-1,i-2)),k=R=.75*m,v=-.4375*m*m}if(M===30&&(m=(R-k)/2,m=m*m+v,m>0)){for(m=Math.sqrt(m),R<k&&(m=-m),m=k-v/((R-k)/2+m),g=o;g<=i;g++)s.set(g,g,s.get(g,g)-m);a+=m,k=R=v=.964}for(M=M+1,E=i-2;E>=N&&(d=s.get(E,E),w=k-d,m=R-d,h=(w*m-v)/s.get(E+1,E)+s.get(E,E+1),c=s.get(E+1,E+1)-d-w-m,w=s.get(E+2,E+1),m=Math.abs(h)+Math.abs(c)+Math.abs(w),h=h/m,c=c/m,w=w/m,!(E===N||Math.abs(s.get(E,E-1))*(Math.abs(c)+Math.abs(w))<l*(Math.abs(h)*(Math.abs(s.get(E-1,E-1))+Math.abs(d)+Math.abs(s.get(E+1,E+1))))));)E--;for(g=E+2;g<=i;g++)s.set(g,g-2,0),g>E+2&&s.set(g,g-3,0);for(x=E;x<=i-1&&(F=x!==i-1,x!==E&&(h=s.get(x,x-1),c=s.get(x+1,x-1),w=F?s.get(x+2,x-1):0,k=Math.abs(h)+Math.abs(c)+Math.abs(w),k!==0&&(h=h/k,c=c/k,w=w/k)),k!==0);x++)if(m=Math.sqrt(h*h+c*c+w*w),h<0&&(m=-m),m!==0){for(x!==E?s.set(x,x-1,-m*k):N!==E&&s.set(x,x-1,-s.get(x,x-1)),h=h+m,k=h/m,R=c/m,d=w/m,c=c/h,w=w/h,b=x;b<n;b++)h=s.get(x,b)+c*s.get(x+1,b),F&&(h=h+w*s.get(x+2,b),s.set(x+2,b,s.get(x+2,b)-h*d)),s.set(x,b,s.get(x,b)-h*k),s.set(x+1,b,s.get(x+1,b)-h*R);for(g=0;g<=Math.min(i,x+3);g++)h=k*s.get(g,x)+R*s.get(g,x+1),F&&(h=h+d*s.get(g,x+2),s.set(g,x+2,s.get(g,x+2)-h*w)),s.set(g,x,s.get(g,x)-h),s.set(g,x+1,s.get(g,x+1)-h*c);for(g=o;g<=u;g++)h=k*e.get(g,x)+R*e.get(g,x+1),F&&(h=h+d*e.get(g,x+2),e.set(g,x+2,e.get(g,x+2)-h*w)),e.set(g,x,e.get(g,x)-h),e.set(g,x+1,e.get(g,x+1)-h*c)}}}if(f!==0){for(i=n-1;i>=0;i--)if(h=r[i],c=t[i],c===0)for(N=i,s.set(i,i,1),g=i-1;g>=0;g--){for(v=s.get(g,g)-h,w=0,b=N;b<=i;b++)w=w+s.get(g,b)*s.get(b,i);if(t[g]<0)d=v,m=w;else if(N=g,t[g]===0?s.set(g,i,v!==0?-w/v:-w/(l*f)):(k=s.get(g,g+1),R=s.get(g+1,g),c=(r[g]-h)*(r[g]-h)+t[g]*t[g],I=(k*m-d*w)/c,s.set(g,i,I),s.set(g+1,i,Math.abs(k)>Math.abs(d)?(-w-v*I)/k:(-m-R*I)/d)),I=Math.abs(s.get(g,i)),l*I*I>1)for(b=g;b<=i;b++)s.set(b,i,s.get(b,i)/I)}else if(c<0)for(N=i-1,Math.abs(s.get(i,i-1))>Math.abs(s.get(i-1,i))?(s.set(i-1,i-1,c/s.get(i,i-1)),s.set(i-1,i,-(s.get(i,i)-h)/s.get(i,i-1))):($=ie(0,-s.get(i-1,i),s.get(i-1,i-1)-h,c),s.set(i-1,i-1,$[0]),s.set(i-1,i,$[1])),s.set(i,i-1,0),s.set(i,i,1),g=i-2;g>=0;g--){for(p=0,y=0,b=N;b<=i;b++)p=p+s.get(g,b)*s.get(b,i-1),y=y+s.get(g,b)*s.get(b,i);if(v=s.get(g,g)-h,t[g]<0)d=v,w=p,m=y;else if(N=g,t[g]===0?($=ie(-p,-y,v,c),s.set(g,i-1,$[0]),s.set(g,i,$[1])):(k=s.get(g,g+1),R=s.get(g+1,g),j=(r[g]-h)*(r[g]-h)+t[g]*t[g]-c*c,S=(r[g]-h)*2*c,j===0&&S===0&&(j=l*f*(Math.abs(v)+Math.abs(c)+Math.abs(k)+Math.abs(R)+Math.abs(d))),$=ie(k*w-d*p+c*y,k*m-d*y-c*p,j,S),s.set(g,i-1,$[0]),s.set(g,i,$[1]),Math.abs(k)>Math.abs(d)+Math.abs(c)?(s.set(g+1,i-1,(-p-v*s.get(g,i-1)+c*s.get(g,i))/k),s.set(g+1,i,(-y-v*s.get(g,i)-c*s.get(g,i-1))/k)):($=ie(-w-R*s.get(g,i-1),-m-R*s.get(g,i),d,c),s.set(g+1,i-1,$[0]),s.set(g+1,i,$[1]))),I=Math.max(Math.abs(s.get(g,i-1)),Math.abs(s.get(g,i))),l*I*I>1)for(b=g;b<=i;b++)s.set(b,i-1,s.get(b,i-1)/I),s.set(b,i,s.get(b,i)/I)}for(g=0;g<n;g++)if(g<o||g>u)for(b=g;b<n;b++)e.set(g,b,s.get(g,b));for(b=n-1;b>=o;b--)for(g=o;g<=u;g++){for(d=0,x=o;x<=Math.min(b,u);x++)d=d+e.get(g,x)*s.get(x,b);e.set(g,b,d)}}}function ie(n,t,r,e){let s,i;return Math.abs(r)>Math.abs(e)?(s=e/r,i=r+s*e,[(n+s*t)/i,(t-s*n)/i]):(s=r/e,i=e+s*r,[(s*n+t)/i,(s*t-n)/i])}class Nr{constructor(t){if(t=H.checkMatrix(t),!t.isSymmetric())throw new Error("Matrix is not symmetric");let r=t,e=r.rows,s=new T(e,e),i=!0,o,u,l;for(u=0;u<e;u++){let a=0;for(l=0;l<u;l++){let f=0;for(o=0;o<l;o++)f+=s.get(l,o)*s.get(u,o);f=(r.get(u,l)-f)/s.get(l,l),s.set(u,l,f),a=a+f*f}for(a=r.get(u,u)-a,i&=a>0,s.set(u,u,Math.sqrt(Math.max(a,0))),l=u+1;l<e;l++)s.set(u,l,0)}this.L=s,this.positiveDefinite=!!i}isPositiveDefinite(){return this.positiveDefinite}solve(t){t=H.checkMatrix(t);let r=this.L,e=r.rows;if(t.rows!==e)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let s=t.columns,i=t.clone(),o,u,l;for(l=0;l<e;l++)for(u=0;u<s;u++){for(o=0;o<l;o++)i.set(l,u,i.get(l,u)-i.get(o,u)*r.get(l,o));i.set(l,u,i.get(l,u)/r.get(l,l))}for(l=e-1;l>=0;l--)for(u=0;u<s;u++){for(o=l+1;o<e;o++)i.set(l,u,i.get(l,u)-i.get(o,u)*r.get(o,l));i.set(l,u,i.get(l,u)/r.get(l,l))}return i}get lowerTriangularMatrix(){return this.L}}class jr{constructor(t,r={}){t=H.checkMatrix(t);let{Y:e}=r;const{scaleScores:s=!1,maxIterations:i=1e3,terminationCriteria:o=1e-10}=r;let u;if(e){if(Z.isAnyArray(e)&&typeof e[0]=="number"?e=T.columnVector(e):e=H.checkMatrix(e),e.rows!==t.rows)throw new Error("Y should have the same number of rows as X");u=e.getColumnVector(0)}else u=t.getColumnVector(0);let l=1,a,f,h,c;for(let w=0;w<i&&l>o;w++)h=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),h=h.div(h.norm()),a=t.mmul(h).div(h.transpose().mmul(h).get(0,0)),w>0&&(l=a.clone().sub(c).pow(2).sum()),c=a.clone(),e?(f=e.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),f=f.div(f.norm()),u=e.mmul(f).div(f.transpose().mmul(f).get(0,0))):u=a;if(e){let w=t.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0));w=w.div(w.norm());let m=t.clone().sub(a.clone().mmul(w.transpose())),d=u.transpose().mmul(a).div(a.transpose().mmul(a).get(0,0)),M=e.clone().sub(a.clone().mulS(d.get(0,0)).mmul(f.transpose()));this.t=a,this.p=w.transpose(),this.w=h.transpose(),this.q=f,this.u=u,this.s=a.transpose().mmul(a),this.xResidual=m,this.yResidual=M,this.betas=d}else this.w=h.transpose(),this.s=a.transpose().mmul(a).sqrt(),s?this.t=a.clone().div(this.s.get(0,0)):this.t=a,this.xResidual=t.sub(a.mmul(h.transpose()))}}z.AbstractMatrix=D,z.CHO=Nr,z.CholeskyDecomposition=Nr,z.DistanceMatrix=ee,z.EVD=Er,z.EigenvalueDecomposition=Er,z.LU=ne,z.LuDecomposition=ne;var kr=z.Matrix=T;z.MatrixColumnSelectionView=Gs,z.MatrixColumnView=Us,z.MatrixFlipColumnView=Ws,z.MatrixFlipRowView=_s,z.MatrixRowSelectionView=Ys,z.MatrixRowView=Xs,z.MatrixSelectionView=re,z.MatrixSubView=Ks,z.MatrixTransposeView=Qs,z.NIPALS=jr,z.Nipals=jr,z.QR=Ae,z.QrDecomposition=Ae,z.SVD=jt,z.SingularValueDecomposition=jt,z.SymmetricMatrix=dt,z.WrapperMatrix1D=vr,z.WrapperMatrix2D=H,z.correlation=si,z.covariance=ni;var Tr=z.default=T;z.determinant=se,z.inverse=Zs,z.linearDependencies=ei;var ai=z.pseudoInverse=ri;z.solve=Sr,z.wrap=Js;const B=kr;Tr.Matrix&&Tr.Matrix;const hi=ai;function Ir(n){let t=Pe(n.getNestedArray(),1);t=t.map(s=>s[0]);let r=Math.max(...t),e=Math.min(...t);return t=t.map(s=>(s-e)/(r-e)),t}function fi(n,t){const r=n.length,e=new K({size:r,numberType:K.NumberType.FLOAT32});e.fill((i,o)=>1-Yt(n[i],n[o]));let s=[];switch(t){case"Classic":s=Pe(e.getNestedArray(),1);break;case"GD":s=Ce(new B(e.getNestedArray()),{lr:5}).coordinates.data;break}return wi(s)}function Rr(n,t="Classic"){const r=[13];let e=null,s=1,i;switch(t){case"Classic":i=Pe(n.getNestedArray(),2);break;case"GDTries":r.push(.5,1,2,4,8);for(let o=0;o<r.length;o++){const u=r[o];i=Ce(new B(n.getNestedArray()),{lr:u}),i.lossPerStep[i.lossPerStep.length-1]<s&&(e=i,s=i.lossPerStep[i.lossPerStep.length-1])}i=e.coordinates.data;break;case"GD":for(let o=0;o<r.length;o++){const u=r[o];i=Ce(new B(n.getNestedArray()),{lr:u}),isNaN(i.lossPerStep[i.lossPerStep.length-1])?r.push(r[r.length-1]/2):i.lossPerStep[i.lossPerStep.length-1]<s&&(e=i,s=i.lossPerStep[i.lossPerStep.length-1])}i=e.coordinates.data;break;case"GN":i=ci(new B(n.getNestedArray())).coordinates.data;break}return pi(i)}function Ce(n,{lr:t=7,maxSteps:r=500,minLossDifference:e=1e-9,momentum:s=0,logEvery:i=0}={}){const o=n.rows;let u=Dr(o);const l=[];let a=null;for(let f=0;f<r;f++){const h=Fr(n,u);if(l.push(h),l.length>1){const c=l[l.length-2];if(Math.abs(c-h)<e||isNaN(h)||h>10)return{coordinates:u,lossPerStep:l}}for(let c=0;c<o;c++){const w=mi(n,u,c);s===0||a==null?a=w:a=B.add(B.mul(a,s),w);const m=B.mul(a,t),d=B.sub(u.getRowVector(c),m);u.setRow(c,d)}}return{coordinates:u,lossPerStep:l}}function ci(n,{lr:t=.7,maxSteps:r=100,minLossDifference:e=1e-4,logEvery:s=5}={}){const i=n.rows;let o=Dr(i);const u=o.columns,l=[];for(let a=0;a<r;a++){const f=Fr(n,o);if(l.push(f),l.length>1){const m=l[l.length-2];if(Math.abs(m-f)<e)return{coordinates:o,lossPerStep:l}}const{residuals:h,jacobian:c}=gi(n,o),w=hi(c).mmul(h);for(let m=0;m<i;m++)for(let d=0;d<u;d++){const M=m*u+d,g=o.get(m,d),b=t*w.get(M,0),x=g-b;o.set(m,d,x)}}return{coordinates:o,lossPerStep:l}}function Dr(n,t=2,r=1){const e=B.rand(n,t,{random:new es(r)});return B.div(e,Math.sqrt(t))}function Fr(n,t){let r=0;const e=Math.pow(t.rows,2);for(let s=0;s<t.rows;s++)for(let i=0;i<t.rows;i++){if(s===i)continue;const o=t.getRowVector(s),u=t.getRowVector(i),l=n.get(s,i),a=B.sub(o,u).norm();r+=Math.pow(l-a,2)/e}return r}function gi(n,t){const r=[],e=t.rows,s=t.columns,i=B.zeros(e*e,e*s);for(let o=0;o<e;o++)for(let u=0;u<e;u++){if(o===u){r.push(0);continue}const l=t.getRowVector(o),a=t.getRowVector(u),f=B.sub(l,a).pow(2).sum(),h=Math.sqrt(f),w=(n.get(o,u)-h)/e;r.push(w);const m=-1/e,d=.5/Math.sqrt(f),M=B.mul(B.sub(l,a),2),g=B.mul(M,m*d),b=e*o+u;for(let x=0;x<s;x++){const N=s*o+x,I=i.get(b,N)+g.get(0,x);i.set(b,N,I)}}return{residuals:B.columnVector(r),jacobian:i}}function mi(n,t,r){const e=t.getRowVector(r),s=Math.pow(t.rows,2);let i=B.zeros(1,e.columns);for(let o=0;o<t.rows;o++){if(r===o)continue;const u=t.getRowVector(o),l=B.sub(e,u).pow(2).sum(),a=Math.sqrt(l),f=[n.get(r,o),n.get(o,r)];for(const h of f){const c=-2*(h-a)/s,w=.5/Math.sqrt(l),m=B.mul(B.sub(e,u),2),d=B.mul(m,c*w);i=B.add(i,d)}}return i}function Pe(n,t){t=t||2;var r=pr(-.5,is(n,2));function e(c){return ss(ls.apply(null,c),c.length)}for(var s=e(r),i=e(fs(r)),o=e(s),u=0;u<r.length;++u)for(var l=0;l<r[0].length;++l)r[u][l]+=o-s[u]-i[l];var a=ns(r),f=os(a.S);return a.U.map(function(c){return pr(c,f).splice(0,t)})}function zr(n){const t=n[0],r=n[1];let e=Math.atan2(r,t)/(2*Math.PI)||.5;e=e<0?1+e:e;const s=Math.sqrt(Math.pow(t,2)+Math.pow(r,2))||.5;return[e,s]}function wi(n){n=n.map(e=>e[0]);let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let e=0;e<n.length;e++)n[e]<t&&(t=n[e]),n[e]>r&&(r=n[e]);for(let e=0;e<n.length;e++)n[e]=(n[e]-t)/(r-t);return n}function pi(n){let t=0,r=0;for(let s=0;s<n.length;s++)t+=n[s][0],r+=n[s][1];t/=n.length,r/=n.length;for(let s=0;s<n.length;s++)n[s][0]-=t,n[s][1]-=r;let e=0;for(let s=0;s<n.length;s++){const i=n[s],o=Math.sqrt(i[0]*i[0]+i[1]*i[1]);o>e&&(e=o)}for(let s=0;s<n.length;s++)n[s]=[n[s][0]/e,n[s][1]/e];return n}var $r={eudist:function(t,r){for(var e=t.length,s=0,i=0;i<e;i++){var o=(t[i]||0)-(r[i]||0);s+=o*o}return s},mandist:function(t,r){for(var e=t.length,s=0,i=0,o=0;o<e;o++)i=(t[o]||0)-(r[o]||0),s+=i>=0?i:-i;return s},dist:function(t,r,e){var s=Math.abs(t-r);return e?s:s*s}},qr=$r,di=qr.eudist,yi=qr.dist,bi={kmrand:function(t,r){for(var e={},s=[],i=r<<2,o=t.length,u=t[0].length>0;s.length<r&&i-- >0;){var l=t[Math.floor(Math.random()*o)],a=u?l.join("_"):"".concat(l);e[a]||(e[a]=!0,s.push(l))}if(s.length<r)throw new Error("Error initializating clusters");return s},kmpp:function(t,r,e){var s=e||(t[0].length?di:yi),i=[],o=t.length,u=t[0].length>0,l=t[Math.floor(Math.random()*o)];for(u?l.join("_"):"".concat(l),i.push(l);i.length<r;){for(var a=[],f=i.length,h=0,c=[],w=0;w<o;w++){for(var m=1/0,d=0;d<f;d++){var M=s(t[w],i[d]);M<=m&&(m=M)}a[w]=m}for(var g=0;g<o;g++)h+=a[g];for(var b=0;b<o;b++)c[b]={i:b,v:t[b],pr:a[b]/h,cs:0};c.sort(function(I,v){return I.pr-v.pr}),c[0].cs=c[0].pr;for(var x=1;x<o;x++)c[x].cs=c[x-1].cs+c[x].pr;for(var N=Math.random(),E=0;E<o-1&&c[E++].cs<N;);i.push(c[E-1].v)}return i}},Ve=$r,Ar=bi;Ve.eudist,Ve.mandist,Ve.dist,Ar.kmrand,Ar.kmpp;function Mi(n,t,r=!1,e=0,s="cosine"){const i=new K({size:n.length,numberType:K.NumberType.UINT8,sampleDuration:t,featureAmount:r?12:1});return i.fillFeaturesNormalized((o,u,l)=>{if(s==="cosine")return Math.max(0,zn(n[o],n[u],l)-e)/(1-e);if(s==="euclidean")return cr(n[o],n[u],l),Math.max(0,Math.min(1,cr(n[o],n[u],l)-e))/(1-e);if(s==="euclideanTimbre")return Math.max(0,Math.min(1,Kt(n[o],n[u])-e))/(1-e)}),i}function Oe(n){if(n instanceof RegExp)return new RegExp(n);if(n instanceof Date)return new Date(n.getTime());if(Array.isArray(n))return n.map(Oe);if(typeof n=="object"&&n!==null){const t={};return Object.keys(n).forEach(r=>{t[r]=Oe(n[r])}),t}return n}function oe(n,t){return n==null||t==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function xi(n,t){return n==null||t==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function Cr(n){let t,r,e;n.length!==2?(t=oe,r=(u,l)=>oe(n(u),l),e=(u,l)=>n(u)-l):(t=n===oe||n===xi?n:vi,r=n,e=n);function s(u,l,a=0,f=u.length){if(a<f){if(t(l,l)!==0)return f;do{const h=a+f>>>1;r(u[h],l)<0?a=h+1:f=h}while(a<f)}return a}function i(u,l,a=0,f=u.length){if(a<f){if(t(l,l)!==0)return f;do{const h=a+f>>>1;r(u[h],l)<=0?a=h+1:f=h}while(a<f)}return a}function o(u,l,a=0,f=u.length){const h=s(u,l,a,f-1);return h>a&&e(u[h-1],l)>-e(u[h],l)?h-1:h}return{left:s,center:o,right:i}}function vi(){return 0}function Si(n){return n===null?NaN:+n}const Ei=Cr(oe).right;Cr(Si).center;const Ni=Math.sqrt(50),ji=Math.sqrt(10),ki=Math.sqrt(2);function le(n,t,r){const e=(t-n)/Math.max(0,r),s=Math.floor(Math.log10(e)),i=e/Math.pow(10,s),o=i>=Ni?10:i>=ji?5:i>=ki?2:1;let u,l,a;return s<0?(a=Math.pow(10,-s)/o,u=Math.round(n*a),l=Math.round(t*a),u/a<n&&++u,l/a>t&&--l,a=-a):(a=Math.pow(10,s)*o,u=Math.round(n/a),l=Math.round(t/a),u*a<n&&++u,l*a>t&&--l),l<u&&.5<=r&&r<2?le(n,t,r*2):[u,l,a]}function Ti(n,t,r){if(t=+t,n=+n,r=+r,!(r>0))return[];if(n===t)return[n];const e=t<n,[s,i,o]=e?le(t,n,r):le(n,t,r);if(!(i>=s))return[];const u=i-s+1,l=new Array(u);if(e)if(o<0)for(let a=0;a<u;++a)l[a]=(i-a)/-o;else for(let a=0;a<u;++a)l[a]=(i-a)*o;else if(o<0)for(let a=0;a<u;++a)l[a]=(s+a)/-o;else for(let a=0;a<u;++a)l[a]=(s+a)*o;return l}function Le(n,t,r){return t=+t,n=+n,r=+r,le(n,t,r)[2]}function Ii(n,t,r){t=+t,n=+n,r=+r;const e=t<n,s=e?Le(t,n,r):Le(n,t,r);return(e?-1:1)*(s<0?1/-s:s)}function qt(n,t,r){n.prototype=t.prototype=r,r.constructor=n}function ue(n,t){var r=Object.create(n.prototype);for(var e in t)r[e]=t[e];return r}function yt(){}var At=.7,ae=1/At,kt="\\s*([+-]?\\d+)\\s*",Ct="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ri=/^#([0-9a-f]{3,8})$/,Di=new RegExp(`^rgb\\(${kt},${kt},${kt}\\)$`),Fi=new RegExp(`^rgb\\(${ot},${ot},${ot}\\)$`),zi=new RegExp(`^rgba\\(${kt},${kt},${kt},${Ct}\\)$`),$i=new RegExp(`^rgba\\(${ot},${ot},${ot},${Ct}\\)$`),qi=new RegExp(`^hsl\\(${Ct},${ot},${ot}\\)$`),Ai=new RegExp(`^hsla\\(${Ct},${ot},${ot},${Ct}\\)$`),Pr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qt(yt,Pt,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Vr,formatHex:Vr,formatHex8:Ci,formatHsl:Pi,formatRgb:Or,toString:Or});function Vr(){return this.rgb().formatHex()}function Ci(){return this.rgb().formatHex8()}function Pi(){return _r(this).formatHsl()}function Or(){return this.rgb().formatRgb()}function Pt(n){var t,r;return n=(n+"").trim().toLowerCase(),(t=Ri.exec(n))?(r=t[1].length,t=parseInt(t[1],16),r===6?Lr(t):r===3?new Q(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?he(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?he(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Di.exec(n))?new Q(t[1],t[2],t[3],1):(t=Fi.exec(n))?new Q(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=zi.exec(n))?he(t[1],t[2],t[3],t[4]):(t=$i.exec(n))?he(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=qi.exec(n))?Wr(t[1],t[2]/100,t[3]/100,1):(t=Ai.exec(n))?Wr(t[1],t[2]/100,t[3]/100,t[4]):Pr.hasOwnProperty(n)?Lr(Pr[n]):n==="transparent"?new Q(NaN,NaN,NaN,0):null}function Lr(n){return new Q(n>>16&255,n>>8&255,n&255,1)}function he(n,t,r,e){return e<=0&&(n=t=r=NaN),new Q(n,t,r,e)}function Br(n){return n instanceof yt||(n=Pt(n)),n?(n=n.rgb(),new Q(n.r,n.g,n.b,n.opacity)):new Q}function P(n,t,r,e){return arguments.length===1?Br(n):new Q(n,t,r,e??1)}function Q(n,t,r,e){this.r=+n,this.g=+t,this.b=+r,this.opacity=+e}qt(Q,P,ue(yt,{brighter(n){return n=n==null?ae:Math.pow(ae,n),new Q(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?At:Math.pow(At,n),new Q(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Q(bt(this.r),bt(this.g),bt(this.b),fe(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ur,formatHex:Ur,formatHex8:Vi,formatRgb:Gr,toString:Gr}));function Ur(){return`#${Mt(this.r)}${Mt(this.g)}${Mt(this.b)}`}function Vi(){return`#${Mt(this.r)}${Mt(this.g)}${Mt(this.b)}${Mt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Gr(){const n=fe(this.opacity);return`${n===1?"rgb(":"rgba("}${bt(this.r)}, ${bt(this.g)}, ${bt(this.b)}${n===1?")":`, ${n})`}`}function fe(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function bt(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Mt(n){return n=bt(n),(n<16?"0":"")+n.toString(16)}function Wr(n,t,r,e){return e<=0?n=t=r=NaN:r<=0||r>=1?n=t=NaN:t<=0&&(n=NaN),new st(n,t,r,e)}function _r(n){if(n instanceof st)return new st(n.h,n.s,n.l,n.opacity);if(n instanceof yt||(n=Pt(n)),!n)return new st;if(n instanceof st)return n;n=n.rgb();var t=n.r/255,r=n.g/255,e=n.b/255,s=Math.min(t,r,e),i=Math.max(t,r,e),o=NaN,u=i-s,l=(i+s)/2;return u?(t===i?o=(r-e)/u+(r<e)*6:r===i?o=(e-t)/u+2:o=(t-r)/u+4,u/=l<.5?i+s:2-i-s,o*=60):u=l>0&&l<1?0:o,new st(o,u,l,n.opacity)}function Oi(n,t,r,e){return arguments.length===1?_r(n):new st(n,t,r,e??1)}function st(n,t,r,e){this.h=+n,this.s=+t,this.l=+r,this.opacity=+e}qt(st,Oi,ue(yt,{brighter(n){return n=n==null?ae:Math.pow(ae,n),new st(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?At:Math.pow(At,n),new st(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,r=this.l,e=r+(r<.5?r:1-r)*t,s=2*r-e;return new Q(Be(n>=240?n-240:n+120,s,e),Be(n,s,e),Be(n<120?n+240:n-120,s,e),this.opacity)},clamp(){return new st(Xr(this.h),ce(this.s),ce(this.l),fe(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=fe(this.opacity);return`${n===1?"hsl(":"hsla("}${Xr(this.h)}, ${ce(this.s)*100}%, ${ce(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Xr(n){return n=(n||0)%360,n<0?n+360:n}function ce(n){return Math.max(0,Math.min(1,n||0))}function Be(n,t,r){return(n<60?t+(r-t)*n/60:n<180?r:n<240?t+(r-t)*(240-n)/60:t)*255}const Li=Math.PI/180,Bi=180/Math.PI,ge=18,Yr=.96422,Kr=1,Qr=.82521,Jr=4/29,Tt=6/29,Zr=3*Tt*Tt,Ui=Tt*Tt*Tt;function Hr(n){if(n instanceof lt)return new lt(n.l,n.a,n.b,n.opacity);if(n instanceof ft)return tn(n);n instanceof Q||(n=Br(n));var t=_e(n.r),r=_e(n.g),e=_e(n.b),s=Ue((.2225045*t+.7168786*r+.0606169*e)/Kr),i,o;return t===r&&r===e?i=o=s:(i=Ue((.4360747*t+.3850649*r+.1430804*e)/Yr),o=Ue((.0139322*t+.0971045*r+.7141733*e)/Qr)),new lt(116*s-16,500*(i-s),200*(s-o),n.opacity)}function Gi(n,t,r,e){return arguments.length===1?Hr(n):new lt(n,t,r,e??1)}function lt(n,t,r,e){this.l=+n,this.a=+t,this.b=+r,this.opacity=+e}qt(lt,Gi,ue(yt,{brighter(n){return new lt(this.l+ge*(n??1),this.a,this.b,this.opacity)},darker(n){return new lt(this.l-ge*(n??1),this.a,this.b,this.opacity)},rgb(){var n=(this.l+16)/116,t=isNaN(this.a)?n:n+this.a/500,r=isNaN(this.b)?n:n-this.b/200;return t=Yr*Ge(t),n=Kr*Ge(n),r=Qr*Ge(r),new Q(We(3.1338561*t-1.6168667*n-.4906146*r),We(-.9787684*t+1.9161415*n+.033454*r),We(.0719453*t-.2289914*n+1.4052427*r),this.opacity)}}));function Ue(n){return n>Ui?Math.pow(n,1/3):n/Zr+Jr}function Ge(n){return n>Tt?n*n*n:Zr*(n-Jr)}function We(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function _e(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Wi(n){if(n instanceof ft)return new ft(n.h,n.c,n.l,n.opacity);if(n instanceof lt||(n=Hr(n)),n.a===0&&n.b===0)return new ft(NaN,0<n.l&&n.l<100?0:NaN,n.l,n.opacity);var t=Math.atan2(n.b,n.a)*Bi;return new ft(t<0?t+360:t,Math.sqrt(n.a*n.a+n.b*n.b),n.l,n.opacity)}function Xe(n,t,r,e){return arguments.length===1?Wi(n):new ft(n,t,r,e??1)}function ft(n,t,r,e){this.h=+n,this.c=+t,this.l=+r,this.opacity=+e}function tn(n){if(isNaN(n.h))return new lt(n.l,0,0,n.opacity);var t=n.h*Li;return new lt(n.l,Math.cos(t)*n.c,Math.sin(t)*n.c,n.opacity)}qt(ft,Xe,ue(yt,{brighter(n){return new ft(this.h,this.c,this.l+ge*(n??1),this.opacity)},darker(n){return new ft(this.h,this.c,this.l-ge*(n??1),this.opacity)},rgb(){return tn(this).rgb()}}));var me=n=>()=>n;function en(n,t){return function(r){return n+r*t}}function _i(n,t,r){return n=Math.pow(n,r),t=Math.pow(t,r)-n,r=1/r,function(e){return Math.pow(n+e*t,r)}}function Xi(n,t){var r=t-n;return r?en(n,r>180||r<-180?r-360*Math.round(r/360):r):me(isNaN(n)?t:n)}function Yi(n){return(n=+n)==1?Vt:function(t,r){return r-t?_i(t,r,n):me(isNaN(t)?r:t)}}function Vt(n,t){var r=t-n;return r?en(n,r):me(isNaN(n)?t:n)}var rn=function n(t){var r=Yi(t);function e(s,i){var o=r((s=P(s)).r,(i=P(i)).r),u=r(s.g,i.g),l=r(s.b,i.b),a=Vt(s.opacity,i.opacity);return function(f){return s.r=o(f),s.g=u(f),s.b=l(f),s.opacity=a(f),s+""}}return e.gamma=n,e}(1);function Ki(n,t){t||(t=[]);var r=n?Math.min(t.length,n.length):0,e=t.slice(),s;return function(i){for(s=0;s<r;++s)e[s]=n[s]*(1-i)+t[s]*i;return e}}function Qi(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ji(n,t){var r=t?t.length:0,e=n?Math.min(r,n.length):0,s=new Array(e),i=new Array(r),o;for(o=0;o<e;++o)s[o]=Qe(n[o],t[o]);for(;o<r;++o)i[o]=t[o];return function(u){for(o=0;o<e;++o)i[o]=s[o](u);return i}}function Zi(n,t){var r=new Date;return n=+n,t=+t,function(e){return r.setTime(n*(1-e)+t*e),r}}function we(n,t){return n=+n,t=+t,function(r){return n*(1-r)+t*r}}function Hi(n,t){var r={},e={},s;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(s in t)s in n?r[s]=Qe(n[s],t[s]):e[s]=t[s];return function(i){for(s in r)e[s]=r[s](i);return e}}var Ye=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ke=new RegExp(Ye.source,"g");function to(n){return function(){return n}}function eo(n){return function(t){return n(t)+""}}function ro(n,t){var r=Ye.lastIndex=Ke.lastIndex=0,e,s,i,o=-1,u=[],l=[];for(n=n+"",t=t+"";(e=Ye.exec(n))&&(s=Ke.exec(t));)(i=s.index)>r&&(i=t.slice(r,i),u[o]?u[o]+=i:u[++o]=i),(e=e[0])===(s=s[0])?u[o]?u[o]+=s:u[++o]=s:(u[++o]=null,l.push({i:o,x:we(e,s)})),r=Ke.lastIndex;return r<t.length&&(i=t.slice(r),u[o]?u[o]+=i:u[++o]=i),u.length<2?l[0]?eo(l[0].x):to(t):(t=l.length,function(a){for(var f=0,h;f<t;++f)u[(h=l[f]).i]=h.x(a);return u.join("")})}function Qe(n,t){var r=typeof t,e;return t==null||r==="boolean"?me(t):(r==="number"?we:r==="string"?(e=Pt(t))?(t=e,rn):ro:t instanceof Pt?rn:t instanceof Date?Zi:Qi(t)?Ki:Array.isArray(t)?Ji:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Hi:we)(n,t)}function no(n,t){return n=+n,t=+t,function(r){return Math.round(n*(1-r)+t*r)}}function so(n){return function(t,r){var e=n((t=Xe(t)).h,(r=Xe(r)).h),s=Vt(t.c,r.c),i=Vt(t.l,r.l),o=Vt(t.opacity,r.opacity);return function(u){return t.h=e(u),t.c=s(u),t.l=i(u),t.opacity=o(u),t+""}}}var nn=so(Xi);function io(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function pe(n,t){if((r=(n=t?n.toExponential(t-1):n.toExponential()).indexOf("e"))<0)return null;var r,e=n.slice(0,r);return[e.length>1?e[0]+e.slice(2):e,+n.slice(r+1)]}function It(n){return n=pe(Math.abs(n)),n?n[1]:NaN}function oo(n,t){return function(r,e){for(var s=r.length,i=[],o=0,u=n[0],l=0;s>0&&u>0&&(l+u+1>e&&(u=Math.max(1,e-l)),i.push(r.substring(s-=u,s+u)),!((l+=u+1)>e));)u=n[o=(o+1)%n.length];return i.reverse().join(t)}}function lo(n){return function(t){return t.replace(/[0-9]/g,function(r){return n[+r]})}}var uo=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function de(n){if(!(t=uo.exec(n)))throw new Error("invalid format: "+n);var t;return new Je({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}de.prototype=Je.prototype;function Je(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Je.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ao(n){t:for(var t=n.length,r=1,e=-1,s;r<t;++r)switch(n[r]){case".":e=s=r;break;case"0":e===0&&(e=r),s=r;break;default:if(!+n[r])break t;e>0&&(e=0);break}return e>0?n.slice(0,e)+n.slice(s+1):n}var sn;function ho(n,t){var r=pe(n,t);if(!r)return n+"";var e=r[0],s=r[1],i=s-(sn=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,o=e.length;return i===o?e:i>o?e+new Array(i-o+1).join("0"):i>0?e.slice(0,i)+"."+e.slice(i):"0."+new Array(1-i).join("0")+pe(n,Math.max(0,t+i-1))[0]}function on(n,t){var r=pe(n,t);if(!r)return n+"";var e=r[0],s=r[1];return s<0?"0."+new Array(-s).join("0")+e:e.length>s+1?e.slice(0,s+1)+"."+e.slice(s+1):e+new Array(s-e.length+2).join("0")}var ln={"%":(n,t)=>(n*100).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:io,e:(n,t)=>n.toExponential(t),f:(n,t)=>n.toFixed(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>on(n*100,t),r:on,s:ho,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function un(n){return n}var an=Array.prototype.map,hn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function fo(n){var t=n.grouping===void 0||n.thousands===void 0?un:oo(an.call(n.grouping,Number),n.thousands+""),r=n.currency===void 0?"":n.currency[0]+"",e=n.currency===void 0?"":n.currency[1]+"",s=n.decimal===void 0?".":n.decimal+"",i=n.numerals===void 0?un:lo(an.call(n.numerals,String)),o=n.percent===void 0?"%":n.percent+"",u=n.minus===void 0?"−":n.minus+"",l=n.nan===void 0?"NaN":n.nan+"";function a(h){h=de(h);var c=h.fill,w=h.align,m=h.sign,d=h.symbol,M=h.zero,g=h.width,b=h.comma,x=h.precision,N=h.trim,E=h.type;E==="n"?(b=!0,E="g"):ln[E]||(x===void 0&&(x=12),N=!0,E="g"),(M||c==="0"&&w==="=")&&(M=!0,c="0",w="=");var I=d==="$"?r:d==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",v=d==="$"?e:/[%p]/.test(E)?o:"",k=ln[E],R=/[defgprs%]/.test(E);x=x===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x));function p(y){var j=I,S=v,F,$,q;if(E==="c")S=k(y)+S,y="";else{y=+y;var V=y<0||1/y<0;if(y=isNaN(y)?l:k(Math.abs(y),x),N&&(y=ao(y)),V&&+y==0&&m!=="+"&&(V=!1),j=(V?m==="("?m:u:m==="-"||m==="("?"":m)+j,S=(E==="s"?hn[8+sn/3]:"")+S+(V&&m==="("?")":""),R){for(F=-1,$=y.length;++F<$;)if(q=y.charCodeAt(F),48>q||q>57){S=(q===46?s+y.slice(F+1):y.slice(F))+S,y=y.slice(0,F);break}}}b&&!M&&(y=t(y,1/0));var U=j.length+y.length+S.length,G=U<g?new Array(g-U+1).join(c):"";switch(b&&M&&(y=t(G+y,G.length?g-S.length:1/0),G=""),w){case"<":y=j+y+S+G;break;case"=":y=j+G+y+S;break;case"^":y=G.slice(0,U=G.length>>1)+j+y+S+G.slice(U);break;default:y=G+j+y+S;break}return i(y)}return p.toString=function(){return h+""},p}function f(h,c){var w=a((h=de(h),h.type="f",h)),m=Math.max(-8,Math.min(8,Math.floor(It(c)/3)))*3,d=Math.pow(10,-m),M=hn[8+m/3];return function(g){return w(d*g)+M}}return{format:a,formatPrefix:f}}var ye,fn,cn;co({thousands:",",grouping:[3],currency:["$",""]});function co(n){return ye=fo(n),fn=ye.format,cn=ye.formatPrefix,ye}function go(n){return Math.max(0,-It(Math.abs(n)))}function mo(n,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(It(t)/3)))*3-It(Math.abs(n)))}function wo(n,t){return n=Math.abs(n),t=Math.abs(t)-n,Math.max(0,It(t)-It(n))+1}function po(n,t){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(t).domain(n);break}return this}function yo(n){return function(){return n}}function bo(n){return+n}var gn=[0,1];function Rt(n){return n}function Ze(n,t){return(t-=n=+n)?function(r){return(r-n)/t}:yo(isNaN(t)?NaN:.5)}function Mo(n,t){var r;return n>t&&(r=n,n=t,t=r),function(e){return Math.max(n,Math.min(t,e))}}function xo(n,t,r){var e=n[0],s=n[1],i=t[0],o=t[1];return s<e?(e=Ze(s,e),i=r(o,i)):(e=Ze(e,s),i=r(i,o)),function(u){return i(e(u))}}function vo(n,t,r){var e=Math.min(n.length,t.length)-1,s=new Array(e),i=new Array(e),o=-1;for(n[e]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<e;)s[o]=Ze(n[o],n[o+1]),i[o]=r(t[o],t[o+1]);return function(u){var l=Ei(n,u,1,e)-1;return i[l](s[l](u))}}function So(n,t){return t.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Eo(){var n=gn,t=gn,r=Qe,e,s,i,o=Rt,u,l,a;function f(){var c=Math.min(n.length,t.length);return o!==Rt&&(o=Mo(n[0],n[c-1])),u=c>2?vo:xo,l=a=null,h}function h(c){return c==null||isNaN(c=+c)?i:(l||(l=u(n.map(e),t,r)))(e(o(c)))}return h.invert=function(c){return o(s((a||(a=u(t,n.map(e),we)))(c)))},h.domain=function(c){return arguments.length?(n=Array.from(c,bo),f()):n.slice()},h.range=function(c){return arguments.length?(t=Array.from(c),f()):t.slice()},h.rangeRound=function(c){return t=Array.from(c),r=no,f()},h.clamp=function(c){return arguments.length?(o=c?!0:Rt,f()):o!==Rt},h.interpolate=function(c){return arguments.length?(r=c,f()):r},h.unknown=function(c){return arguments.length?(i=c,h):i},function(c,w){return e=c,s=w,f()}}function No(){return Eo()(Rt,Rt)}function jo(n,t,r,e){var s=Ii(n,t,r),i;switch(e=de(e??",f"),e.type){case"s":{var o=Math.max(Math.abs(n),Math.abs(t));return e.precision==null&&!isNaN(i=mo(s,o))&&(e.precision=i),cn(e,o)}case"":case"e":case"g":case"p":case"r":{e.precision==null&&!isNaN(i=wo(s,Math.max(Math.abs(n),Math.abs(t))))&&(e.precision=i-(e.type==="e"));break}case"f":case"%":{e.precision==null&&!isNaN(i=go(s))&&(e.precision=i-(e.type==="%")*2);break}}return fn(e)}function ko(n){var t=n.domain;return n.ticks=function(r){var e=t();return Ti(e[0],e[e.length-1],r??10)},n.tickFormat=function(r,e){var s=t();return jo(s[0],s[s.length-1],r??10,e)},n.nice=function(r){r==null&&(r=10);var e=t(),s=0,i=e.length-1,o=e[s],u=e[i],l,a,f=10;for(u<o&&(a=o,o=u,u=a,a=s,s=i,i=a);f-- >0;){if(a=Le(o,u,r),a===l)return e[s]=o,e[i]=u,t(e);if(a>0)o=Math.floor(o/a)*a,u=Math.ceil(u/a)*a;else if(a<0)o=Math.ceil(o*a)/a,u=Math.floor(u*a)/a;else break;l=a}return n},n}function He(){var n=No();return n.copy=function(){return So(n,He())},po.apply(n,arguments),ko(n)}function Ot(n,t,r){this.k=n,this.x=t,this.y=r}Ot.prototype={constructor:Ot,scale:function(n){return n===1?this:new Ot(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new Ot(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},Ot.prototype;const To=["C","D♭","D","E♭","E","F","F♯","G","A♭","A","B♭","B","Cm","D♭m","Dm","E♭m","Em","Fm","F♯m","Gm","A♭m","Am","B♭m","Bm"];He().domain([0,1/12,2/12,2.8/12,3.8/12,4.3/12,5.3/12,6.8/12,8/12,8.8/12,9.3/12,10.5/12,1]).interpolate(nn).range([P("#FE0000"),P("#FF7300"),P("#FFAA01"),P("#FFD300"),P("#FFFF01"),P("#9FEE00"),P("#01CC00"),P("#009899"),P("#1241AB"),P("#3914B1"),P("#7209AC"),P("#CD0174"),P("#FE0000")]),He().domain([0,1/12,2/12,3/12,4/12,5/12,6/12,7/12,8/12,9/12,10/12,11/12,1]).interpolate(nn).range([P("#da321f"),P("#e06300"),P("#e89b00"),P("#ebcb03"),P("#9fbb04"),P("#2cbe03"),P("#03b779"),P("#06b3bd"),P("#3875cc"),P("#7503db"),P("#c203ae"),P("#e84b90"),P("#da321f")]);class Io{constructor(t){C(this,"start");C(this,"end");C(this,"startSample");C(this,"endSample");C(this,"confidence",1);C(this,"groupID",0);C(this,"key",-1);C(this,"mdsFeature");C(this,"parent",!1);C(this,"pathFamily");C(this,"pathFamilyScores");C(this,"score");C(this,"normalizedScore");C(this,"coverage");C(this,"normalizedCoverage");C(this,"fitness");this.start=t.start,this.end=t.end,this.startSample=t.startSample,this.endSample=t.endSample,t.groupID!==void 0&&(this.groupID=t.groupID),t.confidence!==void 0&&(this.confidence=t.confidence),t.mdsFeature!==void 0&&(this.mdsFeature=t.mdsFeature),t.colorAngle!==void 0&&(this.colorAngle=t.colorAngle),t.colorRadius!==void 0&&(this.colorRadius=t.colorRadius)}getDuration(){return this.end-this.start}getVerticalPosition(){}overlaps(t){return this.start<=t.start&&this.end>t.start||this.start<t.start&&this.end>=t.end||t.start<=this.start&&t.end>this.start||t.start<this.start&&t.end>=this.end||this.start>=t.start&&this.end<=t.end||t.start>=this.start&&t.end<=this.end}splits(t){return t.start<this.start&&t.end>this.end}covers(t){return this.start<=t.start&&this.end>=t.end}clipsStart(t){return this.end>t.start&&this.end<t.end&&this.start<=t.start}clipsEnd(t){return this.start>t.start&&this.start<t.end&&this.end>=t.end}disjoint(t){return this.end<=t.start||this.start>=t.end}clone(){return Oe(this)}amountOfSectionsAfterSubtract(t){return t.covers(this)?0:t.splits(this)?2:1}subtract(t){if(t.disjoint(this))return this;if(gt(this.amountOfSectionsAfterSubtract(t)===1,`Won't subtract, subtraction yields ${this.amountOfSectionsAfterSubtract(t)} sections [${this.start}, ${this.end}] - [${t.start}, ${t.end}]`),t.clipsEnd(this)?this.end=t.start:t.clipsStart(this)&&(this.start=t.end),this.end<=this.start)throw new Error("Section end is before start");return this}subtractAndCreateNew(t){if(t.covers(this))return[];if(t.splits(this)){const e=this.clone();e.end=t.start;const s=this.clone();return s.start=t.end,[e,s]}return[this.clone().subtract(t)]}getKeyName(){return To[this.key]}}function Ro(n,t,r=.1){let e=gr(n);e=e.filter(i=>i.confidence>r);const s=[];for(let i=0;i<e.length;i++){const o=e[i],u=o.sample*t,l=o.sample,a=i<e.length-1?t*e[i+1].sample:t*n.length,f=i<e.length-1?e[i+1].sample:n.length,h=o.confidence,c=s.length;s.push(new Io({start:u,end:a,confidence:h,groupID:c,startSample:l,endSample:f}))}return s}function Do(n,t,r){const e=[],s=Rr(t,r),i=Ir(t);n.forEach((l,a)=>{const[f,h]=zr(s[a]),c=l.clone();c.colorAngle=f,c.colorRadius=h,c.mdsFeature=i[a],e.push(c)}),e.sort((l,a)=>l.colorAngle>a.colorAngle?1:a.colorAngle>l.colorAngle?-1:0);let o=1-e[e.length-1].colorAngle+e[0].colorAngle,u=e[0].colorAngle;for(let l=1;l<e.length;l++){const a=e[l].colorAngle-e[l-1].colorAngle;a>o&&(o=a,u=e[l].colorAngle)}return e.forEach(l=>{l.colorAngle=(1+(l.colorAngle-u))%1}),e.sort((l,a)=>l.groupID>a.groupID?1:a.groupID>l.groupID?-1:l.start-a.start),e}function Fo(n,t){const r=Qt(n,t.map(e=>e[0]));return Qt(n,t.map(e=>e[1])),Qt(n,t.map(e=>e[2])),Qt(n,t.map(e=>e[3])),Math.sign(r)<0?n:Math.sign(r)>0?n.map(e=>1-e):n}function zo(n,t,r,e){const s=t.length,i=new K({size:s,numberType:K.NumberType.FLOAT32}),o=[];return t.forEach(u=>{const l=new Float32Array(12).fill(0),a=Math.floor(u.start/r),f=Math.floor(u.end/r),h=f-a;for(let c=a;c<f;c++)for(let w=0;w<12;w++)l[w]+=n[c][w];for(let c=0;c<12;c++)l[c]/=h;o.push(l)}),i.fill((u,l)=>1-Yt(o[u],o[l])),Do(t,i,e)}function $o(n,t,r,e){return zo(n,t,r,e)}function qo(n,t){const r=n.length/t,e=[];for(let s=0;s<t;s++){const i=new Float32Array(12),o=Math.floor(s*r),u=1-(s*r-o),l=Math.floor((s+1)*r),a=(s+1)*r-l;if(u>0)for(let f=0;f<12;f++)i[f]+=n[o][f]*u/r;if(a>0)for(let f=0;f<12;f++)i[f]+=n[l][f]*a/r;for(let f=o+1;f<l;f++)for(let h=0;h<12;h++)i[h]+=n[f][h]/r;e.push(i)}return e}function Ao(n){const t=new K({size:n.length,numberType:K.NumberType.FLOAT32});t.fill((s,i)=>Kt(n[s].timbre,n[i].timbre));const r=Rr(t),e=Ir(t);n.forEach((s,i)=>{const[o,u]=zr(r[i]);s.colorAngle=o,s.colorRadius=u,s.mdsFeature=e[i]||.5})}function Co(n,t,r=1,e=20,s=.01){const i=[],o=Tn(n,4),u=Po(o,t),l=Vo(o,8),a=u.map((d,M)=>d*l[M]),f=gr(a);let h=a.reduce((d,M)=>d+M,0)/a.length;const c=a.map(d=>(d-h)**2);let w=c.reduce((d,M)=>d+M,0),m=Math.sqrt(w/c.length);return f.forEach(d=>{a[d.sample]>=h+m*4&&i.push({time:d.sample*t,confidence:1,uniqueness:a[d.sample],timbre:n[d.sample]})}),Ao(i),i}function Po(n,t){const r=Mi(n,t,!1,0,"euclideanTimbre"),e=[];for(let s=0;s<n.length;s++){let i=0;for(let o=0;o<n.length;o++)i+=r.getValueNormalizedMirrored(s,o);i/=n.length,e.push(1-i)}return e}function Vo(n,t,r=2){const[e,s]=In(n,t,r),i=[];for(let o=0;o<n.length;o++){const u=1-Yt(n[o],e[o]),l=1-Yt(n[o],s[o]);i.push(Math.min(u,l))}return i}const Oo={computeTimbreStructure(n,t){const r=Lo(n,t);return{events:Co(n,t),segmentedTimbreGraph:r}}};function Lo(n,t){const r=Math.round(5),e=Math.round(10),s=fr(n,r),i=Pn(s),o=Rn(i,5),u=Ro(o,t,.2),l=$o(n,u,t),a=[];u.forEach(m=>{const d=n.slice(m.startSample,m.endSample),M=fr(d,e);a.push(M)});const f=[];a.forEach(m=>{f.push(...m)});const h=200,c=qo(f,h);let w=fi(c,"Classic");return w=Fo(w,c),u.forEach((m,d)=>{const M=Math.round(h/n.length*m.startSample),g=Math.round(h/n.length*m.endSample);a[d]=w.slice(M,g),m.graph=a[d].map(b=>1-b),m.mdsFeature=l[d].mdsFeature}),u.filter(m=>m.graph.length>1)}ve(Oo)})();
